openapi: 3.1.0
info:
  title: Test Agent API
  version: 1.0.0
  description: |
    Comprehensive test agent for OAAS validation, testing, and analysis with full framework compatibility.
    Provides testing, validation, and analysis capabilities for OAAS compliance across multiple frameworks.
  contact:
    name: OpenAPI AI Agents Consortium
    url: https://openapi-ai-agents.org
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

x-openapi-ai-agents-standard:
  version: "0.1.1"
  agent_metadata:
    name: "test-agent"
    framework: "multi-framework"
    certification_level: "gold"
    compliance_frameworks: ["ISO_42001_2023", "NIST_AI_RMF_1_0", "EU_AI_ACT"]
  capabilities:
    - "test_execution"
    - "validation_analysis"
    - "code_analysis"
    - "performance_benchmarking"
    - "security_assessment"
    - "documentation_generation"
  protocols: ["openapi", "mcp", "uadp", "a2a"]
  token_management:
    provider: "tiktoken"
    encoding: "o200k_base"
    optimization: "aggressive"
    budget_constraints:
      max_tokens_per_request: 50000
      cost_threshold_usd: 25.0

servers:
  - url: https://api.test-agent.example.com/v1
    description: Production server
  - url: http://localhost:8080/v1
    description: Development server

paths:
  /health:
    get:
      operationId: getHealth
      summary: Health check endpoint
      description: Check test agent health and readiness status
      responses:
        "200":
          description: Test agent is healthy and ready
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"

  /tests/execute:
    post:
      operationId: executeTest
      summary: Execute test scenario
      description: Execute comprehensive test suites and validation scenarios
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TestExecutionRequest"
      responses:
        "200":
          description: Test execution completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TestExecutionResponse"
        "400":
          $ref: "#/components/responses/BadRequest"

  /validation/analyze:
    post:
      operationId: validateCompliance
      summary: Validate OAAS compliance
      description: Analyze and validate OAAS compliance across multiple frameworks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ValidationRequest"
      responses:
        "200":
          description: Validation analysis completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ValidationResponse"
        "400":
          $ref: "#/components/responses/BadRequest"

  /analysis/code:
    post:
      operationId: analyzeCode
      summary: Analyze code quality
      description: Analyze code quality, patterns, and best practices
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CodeAnalysisRequest"
      responses:
        "200":
          description: Code analysis completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CodeAnalysisResponse"
        "400":
          $ref: "#/components/responses/BadRequest"

  /benchmark/performance:
    post:
      operationId: benchmarkPerformance
      summary: Benchmark performance metrics
      description: Benchmark performance metrics and optimization opportunities
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PerformanceBenchmarkRequest"
      responses:
        "200":
          description: Performance benchmark completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PerformanceBenchmarkResponse"
        "400":
          $ref: "#/components/responses/BadRequest"

  /security/assess:
    post:
      operationId: assessSecurity
      summary: Assess security vulnerabilities
      description: Assess security vulnerabilities and compliance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SecurityAssessmentRequest"
      responses:
        "200":
          description: Security assessment completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityAssessmentResponse"
        "400":
          $ref: "#/components/responses/BadRequest"

  /docs/generate:
    post:
      operationId: generateDocumentation
      summary: Generate documentation
      description: Generate comprehensive documentation and reports
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DocumentationRequest"
      responses:
        "200":
          description: Documentation generated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DocumentationResponse"
        "400":
          $ref: "#/components/responses/BadRequest"

  /capabilities:
    get:
      operationId: getCapabilities
      summary: Get agent capabilities
      description: Retrieve list of available capabilities and their status
      responses:
        "200":
          description: Agent capabilities
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CapabilitiesResponse"

  /metrics:
    get:
      operationId: getMetrics
      summary: Get agent metrics
      description: Retrieve performance and usage metrics
      responses:
        "200":
          description: Agent metrics
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AgentMetrics"

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    HealthResponse:
      type: object
      required:
        - status
        - timestamp
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        version:
          type: string
        capabilities:
          type: array
          items:
            type: string
        frameworks:
          type: array
          items:
            type: string

    TestExecutionRequest:
      type: object
      required:
        - test_type
        - parameters
      properties:
        test_type:
          type: string
          enum: [unit, integration, e2e, performance, security, compliance]
        parameters:
          type: object
          additionalProperties: true
        framework:
          type: string
          enum: [langchain, crewai, autogen, openai, anthropic, google]
        timeout_seconds:
          type: integer
          minimum: 30
          maximum: 3600
          default: 300

    TestExecutionResponse:
      type: object
      required:
        - test_id
        - status
        - results
      properties:
        test_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [passed, failed, skipped, error]
        results:
          type: object
          additionalProperties: true
        execution_time_ms:
          type: integer
        coverage_percentage:
          type: number
          format: float
        token_usage:
          $ref: "#/components/schemas/TokenUsage"

    ValidationRequest:
      type: object
      required:
        - specification
        - framework
      properties:
        specification:
          type: string
          description: OAAS specification to validate
        framework:
          type: string
          enum: [langchain, crewai, autogen, openai, anthropic, google]
        compliance_level:
          type: string
          enum: [bronze, silver, gold]
        strict_mode:
          type: boolean
          default: false

    ValidationResponse:
      type: object
      required:
        - validation_id
        - status
        - compliance_level
      properties:
        validation_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [compliant, non_compliant, partially_compliant]
        compliance_level:
          type: string
          enum: [bronze, silver, gold]
        score:
          type: number
          format: float
          minimum: 0
          maximum: 100
        issues:
          type: array
          items:
            $ref: "#/components/schemas/ValidationIssue"
        recommendations:
          type: array
          items:
            type: string
        token_usage:
          $ref: "#/components/schemas/TokenUsage"

    ValidationIssue:
      type: object
      required:
        - severity
        - message
        - path
      properties:
        severity:
          type: string
          enum: [error, warning, info]
        message:
          type: string
        path:
          type: string
        code:
          type: string

    CodeAnalysisRequest:
      type: object
      required:
        - code
        - language
      properties:
        code:
          type: string
          description: Source code to analyze
        language:
          type: string
          enum: [typescript, javascript, python, java, csharp, go]
        analysis_type:
          type: string
          enum: [quality, patterns, security, performance, best_practices]
        framework:
          type: string
          enum: [langchain, crewai, autogen, openai, anthropic, google]

    CodeAnalysisResponse:
      type: object
      required:
        - analysis_id
        - quality_score
        - findings
      properties:
        analysis_id:
          type: string
          format: uuid
        quality_score:
          type: number
          format: float
          minimum: 0
          maximum: 100
        findings:
          type: array
          items:
            $ref: "#/components/schemas/CodeFinding"
        metrics:
          type: object
          additionalProperties: true
        recommendations:
          type: array
          items:
            type: string
        token_usage:
          $ref: "#/components/schemas/TokenUsage"

    CodeFinding:
      type: object
      required:
        - type
        - severity
        - message
        - line
      properties:
        type:
          type: string
          enum: [bug, vulnerability, code_smell, performance, maintainability]
        severity:
          type: string
          enum: [critical, high, medium, low, info]
        message:
          type: string
        line:
          type: integer
        column:
          type: integer
        rule_id:
          type: string

    PerformanceBenchmarkRequest:
      type: object
      required:
        - test_scenario
      properties:
        test_scenario:
          type: string
          description: Performance test scenario
        duration_seconds:
          type: integer
          minimum: 10
          maximum: 3600
          default: 60
        concurrent_users:
          type: integer
          minimum: 1
          maximum: 1000
          default: 10
        metrics:
          type: array
          items:
            type: string
            enum:
              [response_time, throughput, memory_usage, cpu_usage, token_usage]

    PerformanceBenchmarkResponse:
      type: object
      required:
        - benchmark_id
        - status
        - metrics
      properties:
        benchmark_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [completed, failed, timeout]
        metrics:
          type: object
          additionalProperties:
            type: number
        summary:
          type: object
          additionalProperties: true
        recommendations:
          type: array
          items:
            type: string
        token_usage:
          $ref: "#/components/schemas/TokenUsage"

    SecurityAssessmentRequest:
      type: object
      required:
        - target
        - assessment_type
      properties:
        target:
          type: string
          description: Target for security assessment
        assessment_type:
          type: string
          enum:
            [
              vulnerability_scan,
              compliance_check,
              penetration_test,
              code_review,
            ]
        compliance_frameworks:
          type: array
          items:
            type: string
            enum: [iso-42001, nist-ai-rmf, eu-ai-act, owasp, pci-dss]
        severity_threshold:
          type: string
          enum: [critical, high, medium, low]
          default: medium

    SecurityAssessmentResponse:
      type: object
      required:
        - assessment_id
        - status
        - risk_level
        - findings
      properties:
        assessment_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [completed, failed, partial]
        risk_level:
          type: string
          enum: [critical, high, medium, low, minimal]
        findings:
          type: array
          items:
            $ref: "#/components/schemas/SecurityFinding"
        compliance_status:
          type: object
          additionalProperties:
            type: string
        recommendations:
          type: array
          items:
            type: string
        token_usage:
          $ref: "#/components/schemas/TokenUsage"

    SecurityFinding:
      type: object
      required:
        - severity
        - title
        - description
      properties:
        severity:
          type: string
          enum: [critical, high, medium, low, info]
        title:
          type: string
        description:
          type: string
        cve_id:
          type: string
        cvss_score:
          type: number
          format: float
        remediation:
          type: string

    DocumentationRequest:
      type: object
      required:
        - content_type
        - source
      properties:
        content_type:
          type: string
          enum:
            [
              api_docs,
              user_guide,
              technical_spec,
              compliance_report,
              test_report,
            ]
        source:
          type: string
          description: Source content to document
        format:
          type: string
          enum: [markdown, html, pdf, json, yaml]
          default: markdown
        template:
          type: string
          description: Documentation template to use
        include_examples:
          type: boolean
          default: true

    DocumentationResponse:
      type: object
      required:
        - doc_id
        - status
        - content
      properties:
        doc_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [generated, failed, partial]
        content:
          type: string
          description: Generated documentation content
        format:
          type: string
        metadata:
          type: object
          additionalProperties: true
        token_usage:
          $ref: "#/components/schemas/TokenUsage"

    CapabilitiesResponse:
      type: object
      required:
        - capabilities
      properties:
        capabilities:
          type: array
          items:
            $ref: "#/components/schemas/Capability"
        frameworks:
          type: array
          items:
            type: string
        protocols:
          type: array
          items:
            type: string

    Capability:
      type: object
      required:
        - id
        - name
        - status
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [available, busy, disabled, error]
        frameworks:
          type: array
          items:
            type: string
        sla:
          type: string

    AgentMetrics:
      type: object
      required:
        - total_requests
        - success_rate
        - average_response_time
      properties:
        total_requests:
          type: integer
        success_rate:
          type: number
          format: float
        average_response_time:
          type: integer
        capabilities_usage:
          type: object
          additionalProperties:
            type: integer
        frameworks_usage:
          type: object
          additionalProperties:
            type: integer
        token_usage_total:
          type: integer
        cost_total_usd:
          type: number
          format: float

    TokenUsage:
      type: object
      properties:
        total_tokens:
          type: integer
        prompt_tokens:
          type: integer
        completion_tokens:
          type: integer
        cost_usd:
          type: number
          format: float

    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true
        timestamp:
          type: string
          format: date-time

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

security:
  - ApiKeyAuth: []
  - BearerAuth: []
