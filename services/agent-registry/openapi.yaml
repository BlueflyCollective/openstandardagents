openapi: 3.1.0
info:
  title: Agent Registry API
  version: 0.1.0
  description: |
    Universal Agent Registry for managing agent lifecycle, discovery, and monitoring.
    Provides centralized registration and management for AI agents across frameworks.
  contact:
    name: OpenAPI AI Agents Consortium
    url: https://openapi-ai-agents.org
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

x-openapi-ai-agents-standard:
  version: "0.1.0"
  agent_metadata:
    name: "agent-registry"
    framework: "custom"
    certification_level: "bronze"
    compliance_frameworks: ["ISO_42001_2023"]
  capabilities:
    - "agent_registration"
    - "agent_discovery"
    - "agent_lifecycle_management"
    - "agent_monitoring"
  protocols: ["openapi"]
  token_management:
    provider: "tiktoken"
    encoding: "o200k_base"
    optimization: "balanced"

servers:
  - url: https://api.agent-registry.example.com/v1
    description: Production server
  - url: http://localhost:3003/v1  
    description: Development server

paths:
  /health:
    get:
      operationId: getHealth
      summary: Health check endpoint
      description: Check registry health and readiness status
      responses:
        '200':
          description: Registry is healthy and ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /agents:
    get:
      operationId: listAgents
      summary: List registered agents
      description: Retrieve list of all registered agents with optional filtering
      parameters:
        - name: framework
          in: query
          description: Filter by agent framework
          schema:
            type: string
        - name: status
          in: query
          description: Filter by agent status
          schema:
            type: string
            enum: [active, inactive, maintenance]
        - name: certification_level
          in: query
          description: Filter by certification level
          schema:
            type: string
            enum: [bronze, silver, gold]
        - name: limit
          in: query
          description: Maximum number of results
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Number of results to skip
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of agents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

    post:
      operationId: registerAgent
      summary: Register new agent
      description: Register a new agent in the registry
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterAgentRequest'
      responses:
        '201':
          description: Agent registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentRegistrationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Agent already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /agents/{agent_id}:
    get:
      operationId: getAgent
      summary: Get agent details
      description: Retrieve detailed information about a specific agent
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique agent identifier
      responses:
        '200':
          description: Agent details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentDetails'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      operationId: updateAgent
      summary: Update agent
      description: Update agent configuration and metadata
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique agent identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAgentRequest'
      responses:
        '200':
          description: Agent updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentDetails'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      operationId: deregisterAgent
      summary: Deregister agent
      description: Remove agent from registry
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique agent identifier
      responses:
        '204':
          description: Agent deregistered successfully
        '404':
          $ref: '#/components/responses/NotFound'

  /agents/{agent_id}/status:
    get:
      operationId: getAgentStatus
      summary: Get agent status
      description: Get current operational status of agent
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique agent identifier
      responses:
        '200':
          description: Agent status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentStatusResponse'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      operationId: updateAgentStatus
      summary: Update agent status
      description: Update the operational status of an agent
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Unique agent identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StatusUpdateRequest'
      responses:
        '200':
          description: Status updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentStatusResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'

  /discover:
    post:
      operationId: discoverAgents
      summary: Discover agents by capabilities
      description: Find agents that match specified capabilities and requirements
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DiscoveryRequest'
      responses:
        '200':
          description: Matching agents found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiscoveryResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /metrics:
    get:
      operationId: getRegistryMetrics
      summary: Get registry metrics
      description: Retrieve registry usage and performance metrics
      responses:
        '200':
          description: Registry metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegistryMetrics'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication

  schemas:
    HealthResponse:
      type: object
      required:
        - status
        - timestamp
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        version:
          type: string
        registered_agents:
          type: integer

    RegisterAgentRequest:
      type: object
      required:
        - name
        - endpoint_url
        - capabilities
      properties:
        name:
          type: string
          description: Agent name
        description:
          type: string
          description: Agent description
        endpoint_url:
          type: string
          format: uri
          description: Agent API endpoint
        capabilities:
          type: array
          items:
            type: string
          description: List of agent capabilities
        framework:
          type: string
          description: Agent framework (crewai, langchain, etc.)
        certification_level:
          type: string
          enum: [bronze, silver, gold]
        protocols:
          type: array
          items:
            type: string
        metadata:
          type: object
          additionalProperties: true

    AgentRegistrationResponse:
      type: object
      required:
        - agent_id
        - name
        - status
        - registered_at
      properties:
        agent_id:
          type: string
          format: uuid
        name:
          type: string
        status:
          type: string
          enum: [pending, active, inactive]
        registered_at:
          type: string
          format: date-time
        endpoint_url:
          type: string
          format: uri

    AgentListResponse:
      type: object
      required:
        - agents
        - total
      properties:
        agents:
          type: array
          items:
            $ref: '#/components/schemas/AgentSummary'
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    AgentSummary:
      type: object
      required:
        - agent_id
        - name
        - status
      properties:
        agent_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [active, inactive, maintenance]
        framework:
          type: string
        certification_level:
          type: string
          enum: [bronze, silver, gold]
        capabilities:
          type: array
          items:
            type: string
        last_seen:
          type: string
          format: date-time

    AgentDetails:
      allOf:
        - $ref: '#/components/schemas/AgentSummary'
        - type: object
          properties:
            endpoint_url:
              type: string
              format: uri
            protocols:
              type: array
              items:
                type: string
            metadata:
              type: object
              additionalProperties: true
            registered_at:
              type: string
              format: date-time
            updated_at:
              type: string
              format: date-time
            health_check_url:
              type: string
              format: uri

    UpdateAgentRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        endpoint_url:
          type: string
          format: uri
        capabilities:
          type: array
          items:
            type: string
        protocols:
          type: array
          items:
            type: string
        metadata:
          type: object
          additionalProperties: true

    AgentStatusResponse:
      type: object
      required:
        - agent_id
        - status
        - last_checked
      properties:
        agent_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [active, inactive, maintenance, error]
        last_checked:
          type: string
          format: date-time
        response_time_ms:
          type: integer
        error_message:
          type: string
        health_score:
          type: number
          format: float
          minimum: 0
          maximum: 100

    StatusUpdateRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [active, inactive, maintenance]
        message:
          type: string

    DiscoveryRequest:
      type: object
      required:
        - capabilities
      properties:
        capabilities:
          type: array
          items:
            type: string
          description: Required capabilities
        framework:
          type: string
          description: Preferred framework
        certification_level:
          type: string
          enum: [bronze, silver, gold]
          description: Minimum certification level
        protocols:
          type: array
          items:
            type: string
          description: Required protocols
        max_results:
          type: integer
          minimum: 1
          maximum: 50
          default: 10

    DiscoveryResponse:
      type: object
      required:
        - matches
        - total
      properties:
        matches:
          type: array
          items:
            allOf:
              - $ref: '#/components/schemas/AgentSummary'
              - type: object
                properties:
                  match_score:
                    type: number
                    format: float
                    minimum: 0
                    maximum: 100
        total:
          type: integer
        query:
          $ref: '#/components/schemas/DiscoveryRequest'

    RegistryMetrics:
      type: object
      required:
        - total_agents
        - active_agents
        - frameworks
      properties:
        total_agents:
          type: integer
        active_agents:
          type: integer
        inactive_agents:
          type: integer
        frameworks:
          type: object
          additionalProperties:
            type: integer
        certification_levels:
          type: object
          properties:
            bronze:
              type: integer
            silver:
              type: integer
            gold:
              type: integer
        average_response_time_ms:
          type: number
          format: float
        uptime_percentage:
          type: number
          format: float

    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true
        timestamp:
          type: string
          format: date-time

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

security:
  - ApiKeyAuth: []