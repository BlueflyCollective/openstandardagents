# agent.yml - TDDAI Cursor Agent Configuration
# Implements OpenAPI for AI Agents Standard

name: tddai-cursor-agent
version: 1.0.0
class: orchestrator
description: |
  Enterprise-grade multi-agent orchestration system implementing the OpenAPI
  for AI Agents standard. Features protocol bridging (MCP, A2A), token
  optimization, schema evolution, and compliance frameworks.

# Multi-Protocol Support
transport:
  - mcp-stdio
  - http
  - websocket
  - a2a

protocols:
  openapi:
    version: "3.1.0"
    validation: strict
    documentation: auto-generated

  mcp:
    enabled: true
    version: "1.0"
    transport: stdio
    tool_discovery: automatic
    bridge_config: ./protocols/mcp.bridge.yml

  a2a:
    enabled: true
    version: "1.0"
    agent_card: published
    capabilities_negotiation: true
    bridge_config: ./protocols/a2a.bridge.yml

# Token Management Configuration
token_management:
  enabled: true
  provider: tiktoken
  encoding: cl100k_base

  optimization:
    level: aggressive # none|standard|aggressive
    strategies:
      - prompt_compression
      - semantic_caching
      - response_streaming
      - batch_processing
    cache:
      provider: redis
      ttl: 3600

  budgets:
    per_request: 4096
    per_minute: 100000
    daily_limit: 10000000
    cost_alert_threshold_usd: 100.00

  monitoring:
    track_usage: true
    anomaly_detection: true
    reporting_interval: 1h
    alert_channels:
      - email
      - slack
      - pagerduty

# Tool Definitions with Enhanced Metadata
tools:
  # Orchestration Tools
  - name: agent.orchestrate
    description: Orchestrate multiple agents for complex tasks
    category: orchestration
    input_schema: schemas/agent.orchestrate.input.schema.json
    output_schema: schemas/agent.orchestrate.output.schema.json
    token_estimate: 2000
    timeout: 60
    retry_policy:
      max_attempts: 3
      backoff: exponential
    cache_ttl: 0 # No caching for orchestration

  - name: agent.deploy
    description: Deploy specialized agents
    category: orchestration
    input_schema: schemas/agent.deploy.input.schema.json
    output_schema: schemas/agent.deploy.output.schema.json
    token_estimate: 500
    timeout: 30

  # Analysis Tools
  - name: analyze.code
    description: Analyze code for quality, security, and performance
    category: analysis
    input_schema: schemas/analyze.code.input.schema.json
    output_schema: schemas/analyze.code.output.schema.json
    token_estimate: 1500
    timeout: 45
    cache_ttl: 3600

  - name: analyze.security
    description: Security vulnerability analysis
    category: analysis
    input_schema: schemas/analyze.security.input.schema.json
    output_schema: schemas/analyze.security.output.schema.json
    token_estimate: 2000
    timeout: 60

  # Generation Tools
  - name: generate.code
    description: Generate code based on specifications
    category: generation
    input_schema: schemas/generate.code.input.schema.json
    output_schema: schemas/generate.code.output.schema.json
    token_estimate: 3000
    timeout: 90

  - name: generate.documentation
    description: Generate comprehensive documentation
    category: generation
    input_schema: schemas/generate.documentation.input.schema.json
    output_schema: schemas/generate.documentation.output.schema.json
    token_estimate: 2500
    timeout: 60

  # Validation Tools
  - name: validate.compliance
    description: Validate compliance with frameworks
    category: validation
    input_schema: schemas/validate.compliance.input.schema.json
    output_schema: schemas/validate.compliance.output.schema.json
    token_estimate: 1000
    timeout: 30

  # Protocol Bridge Tools
  - name: bridge.protocol
    description: Bridge between different protocols
    category: infrastructure
    input_schema: schemas/bridge.protocol.input.schema.json
    output_schema: schemas/bridge.protocol.output.schema.json
    token_estimate: 200
    timeout: 10

# Orchestration Patterns
orchestration_patterns:
  - name: sequential_analysis
    type: sequential
    description: Step-by-step analysis workflow
    steps:
      - tool: analyze.code
        on_success: next
        on_failure: stop
      - tool: analyze.security
        on_success: next
        on_failure: alert
      - tool: generate.documentation
        on_success: complete
        on_failure: retry
    error_handling: stop_on_critical

  - name: parallel_validation
    type: concurrent
    description: Parallel validation across multiple dimensions
    groups:
      - name: analyzers
        tools: [analyze.code, analyze.security, validate.compliance]
        wait_for: all
        timeout: 120
      - name: generators
        tools: [generate.documentation]
        wait_for: any
        timeout: 60
    merge_strategy: aggregate_results

  - name: hierarchical_development
    type: hierarchical
    description: Manager-worker pattern for complex development
    manager:
      agent: orchestrator
      capabilities:
        - task_decomposition
        - resource_allocation
        - quality_assurance
    workers:
      pool_size: 10
      types:
        - specialist
        - utility
      assignment: capability_based
      load_balancing: weighted_round_robin

  - name: adaptive_research
    type: adaptive
    description: Dynamic topology for research tasks
    initial_topology: star
    optimization:
      algorithm: reinforcement_learning
      objective: minimize_tokens
      constraints:
        - latency_ms < 1000
        - accuracy > 0.95
        - cost_usd < 10
    adaptation_triggers:
      - performance_degradation
      - new_requirements
      - resource_constraints

# Specialized Agent Registry
specialized_agents:
  # Core Orchestration Agents
  - id: orchestrator_prime
    type: orchestrator
    capabilities: [coordination, planning, resource_management]
    model: gpt-4-turbo
    token_limit: 8192

  # Development Specialists
  - id: architect_agent
    type: specialist
    capabilities: [system_design, architecture, patterns]
    model: claude-3-opus
    expertise: [microservices, event_driven, domain_driven]

  - id: code_specialist
    type: specialist
    capabilities: [implementation, refactoring, optimization]
    model: gpt-4
    languages: [python, typescript, go, rust]

  # Analysis Specialists
  - id: security_auditor
    type: specialist
    capabilities: [vulnerability_scanning, threat_modeling, compliance]
    model: specialized_security_model
    certifications: [OWASP, NIST, ISO27001]

  - id: performance_optimizer
    type: specialist
    capabilities: [profiling, bottleneck_analysis, optimization]
    model: gpt-4
    tools: [profiler, benchmark, load_tester]

  # Quality Assurance
  - id: test_engineer
    type: specialist
    capabilities: [unit_testing, integration_testing, e2e_testing]
    model: gpt-4
    frameworks: [jest, pytest, cypress, playwright]

  # Documentation
  - id: documentation_writer
    type: specialist
    capabilities: [technical_writing, api_docs, user_guides]
    model: claude-3
    formats: [markdown, restructured_text, docusaurus]

  # Infrastructure
  - id: devops_engineer
    type: specialist
    capabilities: [ci_cd, deployment, monitoring]
    model: gpt-4
    platforms: [kubernetes, terraform, ansible]

  # Compliance & Governance
  - id: compliance_officer
    type: specialist
    capabilities: [audit, risk_assessment, certification]
    model: specialized_compliance_model
    frameworks: [ISO_42001, NIST_AI_RMF, EU_AI_Act]

# Security Configuration
security:
  authentication:
    required: true
    methods:
      - api_key:
          header: X-API-Key
          rotation_days: 90
      - oauth2:
          provider: auth0
          scopes: [read, write, admin]
      - mutual_tls:
          ca_cert: /certs/ca.pem
          verify_depth: 2

  authorization:
    model: abac # attribute-based access control
    policy_engine: opa
    default_policy: deny
    cache_ttl: 300

  encryption:
    at_rest:
      enabled: true
      algorithm: aes_256_gcm
      key_management: aws_kms
    in_transit:
      protocol: tls
      min_version: "1.3"
      cipher_suites:
        - TLS_AES_256_GCM_SHA384
        - TLS_CHACHA20_POLY1305_SHA256

  rate_limiting:
    enabled: true
    tiers:
      free:
        requests_per_minute: 10
        burst: 15
      standard:
        requests_per_minute: 100
        burst: 150
      premium:
        requests_per_minute: 1000
        burst: 1500

  audit:
    enabled: true
    level: detailed
    events:
      - authentication
      - authorization
      - tool_execution
      - data_access
      - configuration_change
      - compliance_violation
    storage:
      type: immutable
      provider: s3
      bucket: audit-logs
      retention_years: 7
    real_time_monitoring: true

# Governance & Compliance
governance:
  certification_level: silver

  compliance:
    frameworks:
      - framework: ISO_42001_2023
        status: certified
        level: silver
        expiry: "2026-01-27"

      - framework: NIST_AI_RMF_1_0
        status: implemented
        categories:
          - govern: complete
          - map: complete
          - measure: in_progress
          - manage: complete

      - framework: EU_AI_Act
        status: compliant
        risk_level: limited

  monitoring:
    metrics:
      - performance:
          latency_p99: 1000ms
          throughput: 1000rps
          availability: 99.99%
      - quality:
          accuracy: 0.95
          precision: 0.92
          recall: 0.90
      - cost:
          token_efficiency: 0.85
          cache_hit_rate: 0.60
      - compliance:
          audit_pass_rate: 1.0
          incident_rate: 0.001

    alerting:
      enabled: true
      channels:
        - pagerduty:
            integration_key: ${PAGERDUTY_KEY}
            severity_threshold: warning
        - slack:
            webhook_url: ${SLACK_WEBHOOK}
            channel: "#ai-agents-alerts"
        - email:
            recipients: [ops@example.com]

  reporting:
    frequency: weekly
    formats: [json, pdf, html]
    recipients:
      - compliance@example.com
      - management@example.com
    include:
      - performance_metrics
      - token_usage
      - cost_analysis
      - compliance_status
      - incident_reports

# Environment Configuration
env:
  required:
    - OPENAI_API_KEY
    - ANTHROPIC_API_KEY
    - REDIS_URL
    - DATABASE_URL
    - AWS_KMS_KEY_ID

  optional:
    - LOG_LEVEL
    - DEBUG_MODE
    - CACHE_TTL
    - MAX_WORKERS
    - TELEMETRY_ENABLED
    - FEATURE_FLAGS

# Observability
observability:
  metrics:
    provider: prometheus
    endpoint: /metrics
    interval: 15s
    custom_metrics:
      - agent_request_duration_seconds
      - tokens_consumed_total
      - protocol_bridge_latency_seconds
      - cache_hit_ratio
      - compliance_score

  logging:
    provider: elasticsearch
    level: info
    structured: true
    index_pattern: agents-*
    retention_days: 30

  tracing:
    provider: jaeger
    sampling_rate: 0.1
    propagation: w3c

  profiling:
    enabled: true
    provider: pyroscope
    interval: 10s

# Deployment Configuration
deployment:
  strategy: rolling
  health_check:
    path: /health
    interval: 30s
    timeout: 10s
    success_threshold: 2
    failure_threshold: 3

  scaling:
    min_replicas: 2
    max_replicas: 20
    target_cpu: 70
    target_memory: 80
    target_rps: 100

  resources:
    requests:
      cpu: 1000m
      memory: 2Gi
    limits:
      cpu: 2000m
      memory: 4Gi

# Feature Flags
features:
  experimental:
    quantum_safe_encryption: false
    neuromorphic_computing: false
    blockchain_integration: false

  beta:
    advanced_caching: true
    ml_optimization: true
    predictive_scaling: true

  stable:
    protocol_bridging: true
    token_management: true
    compliance_reporting: true

# Capabilities Declaration
capabilities:
  # Core Capabilities
  - multi_agent_orchestration
  - protocol_bridging
  - token_optimization
  - schema_evolution

  # Development Capabilities
  - code_generation
  - code_analysis
  - documentation_generation
  - test_generation

  # Security & Compliance
  - security_scanning
  - vulnerability_assessment
  - compliance_validation
  - audit_reporting

  # Operational Capabilities
  - real_time_monitoring
  - automated_scaling
  - self_healing
  - disaster_recovery

  # Advanced Capabilities
  - reinforcement_learning
  - adaptive_topology
  - predictive_optimization
  - cost_forecasting

# Metadata
metadata:
  created: "2025-01-27"
  updated: "2025-01-27"
  version: "1.0.0"
  standard: "openapi-ai-agents"
  maintainers:
    - name: "TDDAI Team"
      email: "team@bluefly.io"
  repository: "https://github.com/bluefly/tddai"
  documentation: "https://docs.tddai.dev"
  support: "https://support.bluefly.io"
