openapi: 3.1.0
info:
  title: OSSA Deprecation Management API
  description: |
    API-first deprecation management system for the LLM ecosystem. Provides comprehensive
    script migration tracking, CLI command mapping, and deprecation warning management
    across all OSSA projects and tools.
    
    This API enables:
    - Centralized tracking of deprecated scripts and their CLI equivalents
    - Migration progress monitoring across projects
    - Automated deprecation warning generation
    - CLI command discovery and mapping
    - Version management and compliance tracking
  version: 0.1.3
  license:
    name: Apache 2.0
    url: https://opensource.org/licenses/Apache-2.0
  contact:
    name: OSSA Community
    url: https://ossa.agents/community
    email: support@ossa.agents

servers:
  - url: http://localhost:4000/api/v1
    description: Local development server
  - url: https://api.ossa.agents/v1
    description: Production API server

paths:
  /deprecation/scripts:
    get:
      summary: List all deprecated scripts
      description: Retrieve a list of all deprecated scripts across the ecosystem
      operationId: listDeprecatedScripts
      parameters:
        - name: project
          in: query
          description: Filter by project name
          schema:
            type: string
        - name: status
          in: query
          description: Filter by deprecation status
          schema:
            $ref: '#/components/schemas/DeprecationStatus'
        - name: phase
          in: query
          description: Filter by deprecation phase
          schema:
            type: integer
            minimum: 1
            maximum: 4
      responses:
        '200':
          description: List of deprecated scripts
          content:
            application/json:
              schema:
                type: object
                properties:
                  scripts:
                    type: array
                    items:
                      $ref: '#/components/schemas/DeprecatedScript'
                  total:
                    type: integer
                  filtered:
                    type: integer
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      summary: Register a new deprecated script
      description: Register a script for deprecation tracking
      operationId: registerDeprecatedScript
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterScriptRequest'
      responses:
        '201':
          description: Script registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeprecatedScript'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Script already registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalError'

  /deprecation/scripts/{scriptId}:
    get:
      summary: Get deprecated script details
      description: Retrieve detailed information about a specific deprecated script
      operationId: getDeprecatedScript
      parameters:
        - name: scriptId
          in: path
          required: true
          description: The script identifier
          schema:
            type: string
      responses:
        '200':
          description: Script details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeprecatedScript'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      summary: Update deprecated script
      description: Update the status or details of a deprecated script
      operationId: updateDeprecatedScript
      parameters:
        - name: scriptId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateScriptRequest'
      responses:
        '200':
          description: Script updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeprecatedScript'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      summary: Remove deprecated script
      description: Remove a script from deprecation tracking (use carefully)
      operationId: removeDeprecatedScript
      parameters:
        - name: scriptId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Script removed successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /migration/status:
    get:
      summary: Get overall migration status
      description: Retrieve migration progress across all projects and scripts
      operationId: getMigrationStatus
      parameters:
        - name: project
          in: query
          description: Filter by project name
          schema:
            type: string
      responses:
        '200':
          description: Migration status overview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MigrationStatus'
        '500':
          $ref: '#/components/responses/InternalError'

  /migration/plan/{project}:
    get:
      summary: Get migration plan for project
      description: Generate or retrieve a migration plan for a specific project
      operationId: getMigrationPlan
      parameters:
        - name: project
          in: path
          required: true
          description: Project name
          schema:
            type: string
      responses:
        '200':
          description: Migration plan for the project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MigrationPlan'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      summary: Generate migration plan
      description: Generate a new migration plan for the specified project
      operationId: generateMigrationPlan
      parameters:
        - name: project
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GeneratePlanRequest'
      responses:
        '201':
          description: Migration plan generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MigrationPlan'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /migration/validate:
    post:
      summary: Validate migration completeness
      description: Validate that all deprecated scripts have CLI equivalents
      operationId: validateMigration
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                projects:
                  type: array
                  items:
                    type: string
                  description: Specific projects to validate (optional)
                strict:
                  type: boolean
                  default: false
                  description: Enable strict validation mode
      responses:
        '200':
          description: Validation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /migration/track/{scriptId}:
    post:
      summary: Track script migration
      description: Track the migration progress of an individual script
      operationId: trackScriptMigration
      parameters:
        - name: scriptId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrackMigrationRequest'
      responses:
        '200':
          description: Migration tracking updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MigrationTrackingResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /cli/commands:
    get:
      summary: List available CLI commands
      description: Retrieve all available CLI commands and their mappings
      operationId: listCliCommands
      parameters:
        - name: tool
          in: query
          description: Filter by CLI tool (agent-ops, agent-forge, etc.)
          schema:
            type: string
            enum: [agent-ops, agent-forge, agent-studio, agent-cli, ossa]
      responses:
        '200':
          description: List of CLI commands
          content:
            application/json:
              schema:
                type: object
                properties:
                  commands:
                    type: array
                    items:
                      $ref: '#/components/schemas/CliCommand'
                  tools:
                    type: array
                    items:
                      type: string
        '500':
          $ref: '#/components/responses/InternalError'

  /cli/mapping/{scriptId}:
    get:
      summary: Get CLI command mapping for script
      description: Get the CLI equivalent command for a deprecated script
      operationId: getCliMapping
      parameters:
        - name: scriptId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: CLI command mapping
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CliMapping'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /warnings/generate:
    post:
      summary: Generate deprecation warnings
      description: Generate deprecation warnings for scripts and update documentation
      operationId: generateWarnings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateWarningsRequest'
      responses:
        '200':
          description: Warnings generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WarningGenerationResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /health:
    get:
      summary: API health check
      description: Check the health of the deprecation management API
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [healthy]
                  version:
                    type: string
                  timestamp:
                    type: string
                    format: date-time

components:
  schemas:
    DeprecatedScript:
      type: object
      required:
        - id
        - name
        - project
        - path
        - status
        - phase
        - created
      properties:
        id:
          type: string
          description: Unique identifier for the script
        name:
          type: string
          description: Script filename
        project:
          type: string
          description: Project name containing the script
        path:
          type: string
          description: Full path to the script file
        status:
          $ref: '#/components/schemas/DeprecationStatus'
        phase:
          type: integer
          minimum: 1
          maximum: 4
          description: Current deprecation phase (1-4)
        cliEquivalent:
          type: string
          description: CLI command that replaces this script
        description:
          type: string
          description: Description of what the script does
        created:
          type: string
          format: date-time
          description: When the script was registered for deprecation
        lastModified:
          type: string
          format: date-time
          description: Last modification timestamp
        migrationDeadline:
          type: string
          format: date
          description: Deadline for migration to CLI
        usageCount:
          type: integer
          description: Number of times script has been executed
        tags:
          type: array
          items:
            type: string
          description: Tags for categorization

    DeprecationStatus:
      type: string
      enum:
        - warning
        - redirecting
        - error
        - removed
      description: Current status of the deprecated script

    RegisterScriptRequest:
      type: object
      required:
        - name
        - project
        - path
        - cliEquivalent
      properties:
        name:
          type: string
        project:
          type: string
        path:
          type: string
        cliEquivalent:
          type: string
        description:
          type: string
        phase:
          type: integer
          minimum: 1
          maximum: 4
          default: 1
        migrationDeadline:
          type: string
          format: date
        tags:
          type: array
          items:
            type: string

    UpdateScriptRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/DeprecationStatus'
        phase:
          type: integer
          minimum: 1
          maximum: 4
        cliEquivalent:
          type: string
        description:
          type: string
        migrationDeadline:
          type: string
          format: date
        tags:
          type: array
          items:
            type: string

    MigrationStatus:
      type: object
      properties:
        overall:
          type: object
          properties:
            totalScripts:
              type: integer
            migratedScripts:
              type: integer
            completionPercentage:
              type: number
              format: float
            nextMilestone:
              type: string
              format: date
        byProject:
          type: array
          items:
            type: object
            properties:
              project:
                type: string
              totalScripts:
                type: integer
              migratedScripts:
                type: integer
              completionPercentage:
                type: number
                format: float
        byPhase:
          type: array
          items:
            type: object
            properties:
              phase:
                type: integer
              scriptCount:
                type: integer
              description:
                type: string

    MigrationPlan:
      type: object
      properties:
        project:
          type: string
        version:
          type: string
        created:
          type: string
          format: date-time
        steps:
          type: array
          items:
            type: object
            properties:
              order:
                type: integer
              description:
                type: string
              scriptId:
                type: string
              cliCommand:
                type: string
              estimatedTime:
                type: string
              dependencies:
                type: array
                items:
                  type: string
        estimatedCompletion:
          type: string
          format: date-time
        riskAssessment:
          type: object
          properties:
            level:
              type: string
              enum: [low, medium, high]
            factors:
              type: array
              items:
                type: string

    GeneratePlanRequest:
      type: object
      properties:
        targetVersion:
          type: string
          default: "0.1.3"
        includeRiskAssessment:
          type: boolean
          default: true
        prioritizeByUsage:
          type: boolean
          default: true

    ValidationResult:
      type: object
      properties:
        valid:
          type: boolean
        summary:
          type: object
          properties:
            totalScripts:
              type: integer
            validatedScripts:
              type: integer
            missingCliEquivalents:
              type: integer
        issues:
          type: array
          items:
            type: object
            properties:
              scriptId:
                type: string
              issue:
                type: string
              severity:
                type: string
                enum: [warning, error, critical]
              suggestion:
                type: string
        recommendations:
          type: array
          items:
            type: string

    TrackMigrationRequest:
      type: object
      required:
        - event
      properties:
        event:
          type: string
          enum: [started, completed, failed, postponed]
        notes:
          type: string
        completedSteps:
          type: array
          items:
            type: string
        remainingWork:
          type: array
          items:
            type: string

    MigrationTrackingResult:
      type: object
      properties:
        scriptId:
          type: string
        currentStatus:
          type: string
        progress:
          type: number
          format: float
        timeline:
          type: array
          items:
            type: object
            properties:
              timestamp:
                type: string
                format: date-time
              event:
                type: string
              notes:
                type: string

    CliCommand:
      type: object
      properties:
        id:
          type: string
        tool:
          type: string
        command:
          type: string
        description:
          type: string
        usage:
          type: string
        examples:
          type: array
          items:
            type: string
        replacesScripts:
          type: array
          items:
            type: string

    CliMapping:
      type: object
      properties:
        scriptId:
          type: string
        scriptPath:
          type: string
        cliTool:
          type: string
        cliCommand:
          type: string
        usageExample:
          type: string
        migrationInstructions:
          type: array
          items:
            type: string

    GenerateWarningsRequest:
      type: object
      properties:
        scriptIds:
          type: array
          items:
            type: string
        projects:
          type: array
          items:
            type: string
        phase:
          type: integer
          minimum: 1
          maximum: 4
        updateDocumentation:
          type: boolean
          default: true

    WarningGenerationResult:
      type: object
      properties:
        generated:
          type: integer
        updated:
          type: integer
        errors:
          type: array
          items:
            type: object
            properties:
              scriptId:
                type: string
              error:
                type: string
        warnings:
          type: array
          items:
            type: object
            properties:
              scriptId:
                type: string
              warningText:
                type: string
              insertedAt:
                type: string

    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
        timestamp:
          type: string
          format: date-time

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication

security:
  - ApiKeyAuth: []

tags:
  - name: Scripts
    description: Deprecated script management
  - name: Migration
    description: Migration planning and tracking
  - name: CLI
    description: CLI command management
  - name: Warnings
    description: Deprecation warning generation
  - name: Health
    description: API health and monitoring