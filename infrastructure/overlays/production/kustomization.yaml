apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: ossa-production

namespace: ossa-production

resources:
- ../../base

commonLabels:
  environment: production
  app.kubernetes.io/instance: ossa-production

patchesStrategicMerge:
- production-patches.yaml

images:
- name: registry.gitlab.com/llm/ossa/ossa-api
  newTag: v1.0.0
- name: registry.gitlab.com/llm/ossa/ossa-validator
  newTag: v1.0.0

configMapGenerator:
- name: ossa-config
  behavior: merge
  literals:
  - NODE_ENV=production
  - LOG_LEVEL=warn
  - ENABLE_METRICS=true
  - ENABLE_TRACING=false
  - RATE_LIMIT_ENABLED=true
  - CACHE_TTL=3600

secretGenerator:
- name: ossa-secrets
  behavior: replace
  envs:
  - production.env

replicas:
- name: ossa-api
  count: 3
- name: ossa-validator
  count: 2
- name: ossa-web
  count: 2