openapi: 3.1.0
info:
  title: Claude Code Analyzer Agent API
  version: 1.0.0
  description: Specialized Claude Code agent API for comprehensive code analysis, security scanning, performance optimization, and quality assessment
  contact:
    name: OpenAPI AI Agents Standard
    url: https://github.com/openapi-ai-agents/standard
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

  # OAAS Extensions
  x-openapi-ai-agents-standard:
    version: "0.1.1"
    certification_level: "silver"
    compliance_frameworks: ["iso-42001", "nist-ai-rmf"]
    token_optimization: "enabled"
    protocol_bridges: ["mcp", "openai", "custom"]

  x-agent-metadata:
    class: "claude-code-agent"
    type: "analyzer"
    protocols: ["openapi", "mcp", "uadp"]
    capabilities: ["code_quality_analysis", "security_vulnerability_scan", "performance_optimization"]
    domains: ["code-analysis", "security", "performance", "quality-assurance"]
    specialization: "claude-code-integration"

  x-claude-code-integration:
    agent_type: "analyzer"
    optimization_level: "production"
    response_format: "structured"
    streaming_support: true

  x-protocol-bridges:
    mcp:
      enabled: true
      latency: "<100ms"
      server_compatible: true
      claude_desktop_optimized: true
      tools_endpoint: "/mcp/tools"
      resources_endpoint: "/mcp/resources"
    openai:
      enabled: true
      latency: "<200ms"
      function_calling: true
      assistant_api: true
    uadp:
      enabled: true
      discovery_endpoint: "/uadp/discover"
      capability_advertising: true

  x-token-management:
    optimization_enabled: true
    target_savings: "35-45%"
    strategies:
      - "context_compression"
      - "result_caching"
      - "pattern_recognition"
      - "incremental_analysis"

  x-performance:
    caching: "semantic"
    compression: "enabled"
    response_time_target: "300ms"
    throughput_target: "100rps"

servers:
  - url: http://localhost:3003/api/v1/agents/analyzer
    description: Local OAAS validation server
  - url: http://localhost:8080/api/v1/agents/analyzer
    description: Local development server

security:
  - ApiKeyAuth: []
  - BearerAuth: []

paths:
  /health:
    get:
      operationId: healthCheck
      summary: Health check endpoint
      description: Returns the health status of the Claude Code analyzer agent
      tags:
        - Health
      security: []
      responses:
        "200":
          description: Agent is healthy
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthStatus"
        "503":
          description: Agent is unhealthy
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /capabilities:
    get:
      operationId: getCapabilities
      summary: Get agent capabilities
      description: Returns the available capabilities and supported frameworks
      tags:
        - Capabilities
      responses:
        "200":
          description: Agent capabilities
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CapabilityMatrix"

  /analyze/code:
    post:
      operationId: analyzeCode
      summary: Analyze code quality
      description: Analyze code for quality, patterns, conventions, and maintainability
      tags:
        - Code Analysis
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CodeAnalysisRequest"
      responses:
        "200":
          description: Code analysis results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CodeAnalysisResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /scan/security:
    post:
      operationId: scanSecurity
      summary: Scan for security vulnerabilities
      description: Scan code for security vulnerabilities, OWASP compliance, and potential threats
      tags:
        - Security Analysis
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SecurityScanRequest"
      responses:
        "200":
          description: Security scan results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecurityScanResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /optimize/performance:
    post:
      operationId: optimizePerformance
      summary: Analyze performance optimization opportunities
      description: Identify performance bottlenecks and suggest optimizations
      tags:
        - Performance Analysis
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PerformanceAnalysisRequest"
      responses:
        "200":
          description: Performance analysis results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PerformanceAnalysisResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /metrics/calculate:
    post:
      operationId: calculateMetrics
      summary: Calculate code complexity metrics
      description: Calculate cyclomatic complexity, maintainability index, and other metrics
      tags:
        - Code Metrics
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MetricsRequest"
      responses:
        "200":
          description: Code metrics results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MetricsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    HealthStatus:
      type: object
      required: [status, timestamp, agent_type]
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        agent_type:
          type: string
          example: "claude-code-analyzer"
        version:
          type: string
          example: "1.0.0"
        uptime:
          type: number
          description: Uptime in seconds
        dependencies:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              status:
                type: string
              response_time_ms:
                type: number

    CapabilityMatrix:
      type: object
      required: [capabilities, frameworks, compliance]
      properties:
        capabilities:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              name:
                type: string
              description:
                type: string
              frameworks:
                type: array
                items:
                  type: string
              input_schema:
                type: object
              output_schema:
                type: object
        frameworks:
          type: array
          items:
            type: string
          example: ["mcp", "openai", "langchain"]
        compliance:
          type: array
          items:
            type: string
          example: ["iso-42001", "nist-ai-rmf"]

    CodeAnalysisRequest:
      type: object
      required: [code]
      properties:
        code:
          type: string
          description: Source code to analyze
        language:
          type: string
          enum: [javascript, typescript, python, java, go, rust, cpp, csharp]
          default: javascript
        analysis_type:
          type: string
          enum: [quality, patterns, conventions, maintainability, all]
          default: all
        include_suggestions:
          type: boolean
          default: true
        severity_threshold:
          type: string
          enum: [low, medium, high, critical]
          default: medium

    CodeAnalysisResponse:
      type: object
      required: [analysis_id, status, results]
      properties:
        analysis_id:
          type: string
        status:
          type: string
          enum: [completed, failed, partial]
        timestamp:
          type: string
          format: date-time
        results:
          type: object
          properties:
            quality_score:
              type: number
              minimum: 0
              maximum: 100
            issues:
              type: array
              items:
                $ref: "#/components/schemas/QualityIssue"
            suggestions:
              type: array
              items:
                $ref: "#/components/schemas/Suggestion"
            metrics:
              $ref: "#/components/schemas/CodeMetrics"

    SecurityScanRequest:
      type: object
      required: [target]
      properties:
        target:
          oneOf:
            - type: string
              description: Source code to scan
            - type: object
              properties:
                type:
                  type: string
                  enum: [file, directory, repository]
                path:
                  type: string
        scan_depth:
          type: string
          enum: [surface, deep, comprehensive]
          default: deep
        scan_types:
          type: array
          items:
            type: string
            enum: [vulnerabilities, secrets, dependencies, owasp]
          default: [vulnerabilities, secrets, dependencies]

    SecurityScanResponse:
      type: object
      required: [scan_id, status, results]
      properties:
        scan_id:
          type: string
        status:
          type: string
          enum: [completed, failed, partial]
        timestamp:
          type: string
          format: date-time
        results:
          type: object
          properties:
            security_score:
              type: number
              minimum: 0
              maximum: 100
            vulnerabilities:
              type: array
              items:
                $ref: "#/components/schemas/Vulnerability"
            secrets_detected:
              type: array
              items:
                $ref: "#/components/schemas/Secret"
            dependency_issues:
              type: array
              items:
                $ref: "#/components/schemas/DependencyIssue"

    PerformanceAnalysisRequest:
      type: object
      required: [code]
      properties:
        code:
          type: string
        language:
          type: string
        analysis_scope:
          type: string
          enum: [function, class, module, application]
          default: function
        performance_targets:
          type: object
          properties:
            response_time_ms:
              type: number
            memory_usage_mb:
              type: number
            cpu_usage_percent:
              type: number

    PerformanceAnalysisResponse:
      type: object
      properties:
        analysis_id:
          type: string
        bottlenecks:
          type: array
          items:
            $ref: "#/components/schemas/PerformanceBottleneck"
        optimizations:
          type: array
          items:
            $ref: "#/components/schemas/OptimizationSuggestion"
        performance_score:
          type: number
          minimum: 0
          maximum: 100

    QualityIssue:
      type: object
      properties:
        type:
          type: string
        severity:
          type: string
          enum: [low, medium, high, critical]
        message:
          type: string
        line_number:
          type: integer
        column_number:
          type: integer
        rule:
          type: string

    Suggestion:
      type: object
      properties:
        type:
          type: string
        description:
          type: string
        impact:
          type: string
          enum: [low, medium, high]
        effort:
          type: string
          enum: [low, medium, high]
        before:
          type: string
        after:
          type: string

    CodeMetrics:
      type: object
      properties:
        cyclomatic_complexity:
          type: number
        maintainability_index:
          type: number
        lines_of_code:
          type: integer
        cognitive_complexity:
          type: number
        test_coverage:
          type: number

    Vulnerability:
      type: object
      properties:
        id:
          type: string
        severity:
          type: string
          enum: [low, medium, high, critical]
        category:
          type: string
        description:
          type: string
        location:
          type: string
        cwe_id:
          type: string
        owasp_category:
          type: string

    Secret:
      type: object
      properties:
        type:
          type: string
        location:
          type: string
        confidence:
          type: string
          enum: [low, medium, high]

    DependencyIssue:
      type: object
      properties:
        package:
          type: string
        version:
          type: string
        issue_type:
          type: string
          enum: [vulnerability, license, outdated]
        severity:
          type: string

    PerformanceBottleneck:
      type: object
      properties:
        type:
          type: string
        location:
          type: string
        impact:
          type: string
        description:
          type: string

    OptimizationSuggestion:
      type: object
      properties:
        type:
          type: string
        description:
          type: string
        expected_improvement:
          type: string
        implementation_effort:
          type: string
          enum: [low, medium, high]

    MetricsRequest:
      type: object
      required: [code]
      properties:
        code:
          type: string
        language:
          type: string
        metrics:
          type: array
          items:
            type: string
          default: [cyclomatic_complexity, maintainability_index, lines_of_code]

    MetricsResponse:
      type: object
      properties:
        metrics:
          $ref: "#/components/schemas/CodeMetrics"

    ErrorResponse:
      type: object
      required: [error, message, timestamp]
      properties:
        error:
          type: string
        message:
          type: string
        timestamp:
          type: string
          format: date-time
        request_id:
          type: string
        details:
          type: object

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    
    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"