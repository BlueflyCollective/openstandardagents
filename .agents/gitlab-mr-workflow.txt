===========================================
GITLAB MERGE REQUEST WORKFLOW
===========================================

## Step-by-Step Process

### 1. GET LIST OF OPEN MRs

Visit: https://gitlab.bluefly.io/groups/llm/-/merge_requests

For each MR, note:
- MR number (e.g., !123)
- Project name
- Source branch
- Target branch
- Status/Issues

### 2. SHARE MR WITH ME

Paste the following for each MR:

```
MR Number: !123
Project: OSSA
Title: [title]
Source Branch: feature/xyz
Target Branch: main
Description: [paste description]
Pipeline Status: [passing/failing]
Conflicts: [yes/no]
Files Changed: [number]
```

Then I can help you:
- Review the changes
- Identify issues
- Provide fix commands
- Suggest improvements
- Write commit messages

### 3. USE THE HELPER SCRIPT

```bash
cd /Users/flux423/Sites/LLM/OSSA/.agents
bash merge-request-helper.sh
```

The script will help you:
- Checkout MR branches
- Run validations
- Auto-fix common issues
- Run tests
- Commit and push fixes

### 4. MANUAL MR REVIEW PROCESS

For each MR:

**A. Checkout the branch**
```bash
cd /Users/flux423/Sites/LLM/[project]
git fetch origin
git checkout [mr-branch]
```

**B. Run validations**
```bash
# TypeScript projects
npm install
npm run lint
npm test
npx tsc --noEmit

# PHP/Drupal projects
composer install
./vendor/bin/phpcs
./vendor/bin/phpstan analyze
```

**C. Check for policy violations**
```bash
# Look for forbidden files
git diff origin/main --name-only | grep -E '\.(md|sh|txt)$'

# Check naming conventions
git diff origin/main --name-only | grep -v 'kebab-case-pattern'
```

**D. Auto-fix issues**
```bash
# Format code
npx prettier --write "**/*.{ts,js,json,yml,yaml}"

# Fix linting
npm run lint:fix

# Remove forbidden files
git rm [file].md
# Then add content to GitLab Wiki instead
```

**E. Commit fixes**
```bash
git add .
git commit -m "fix: address MR feedback

- Fixed linting issues
- Applied Prettier formatting
- Resolved merge conflicts
- Added missing tests"
git push
```

**F. Approve & Merge**
```bash
# In GitLab UI:
# 1. Review all changes
# 2. Check pipeline status
# 3. Resolve discussions
# 4. Click "Merge"
```

### 5. COMMON ISSUES & FIXES

**Issue: Merge Conflicts**
```bash
git fetch origin
git merge origin/main
# Fix conflicts in editor
git add .
git commit -m "fix: resolve merge conflicts"
git push
```

**Issue: Linting Errors**
```bash
npm run lint:fix
git add .
git commit -m "fix: resolve linting errors"
git push
```

**Issue: TypeScript Errors**
```bash
npx tsc --noEmit
# Fix errors in files
git add .
git commit -m "fix: resolve TypeScript errors"
git push
```

**Issue: Forbidden Files (.md, .sh, .txt)**
```bash
# Move content to GitLab Wiki
# Then remove from repo
git rm docs/README.md
git commit -m "chore: move docs to GitLab Wiki"
git push
```

**Issue: Failed Tests**
```bash
npm test
# Fix failing tests
git add .
git commit -m "fix: update tests"
git push
```

### 6. BULK MR OPERATIONS

**Check all MRs for common issues:**
```bash
# Create script
for mr in 123 124 125; do
  git checkout mr-${mr}
  npm run lint
  npm test
  git checkout main
done
```

### 7. PRIORITY ORDER

Process MRs in this order:
1. **Critical** - Blocking deployments
2. **High** - Bug fixes, security
3. **Medium** - Features, enhancements
4. **Low** - Documentation, cleanup

### 8. QUICK COMMANDS

```bash
# List all MR branches
git branch -r | grep -i "merge\|mr"

# Check MR status
git log origin/main..origin/[mr-branch] --oneline

# Test MR locally
git checkout [mr-branch]
npm install && npm test

# Merge MR locally (after approval)
git checkout main
git merge [mr-branch]
git push
```

===========================================
WORKFLOW COMPLETE
===========================================

Now tell me:
1. Which MR number should we start with?
2. What project is it in?
3. What issues are showing?

I'll guide you through fixing it!
