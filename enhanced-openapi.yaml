openapi: 3.1.0
info:
  title: OpenAPI AI Agents Standard - Enhanced Enterprise Edition
  version: 2.1.0
  description: |
    Production-ready OpenAPI specification for AI Agent interoperability with comprehensive
    enterprise features including MCP/A2A protocol bridges, advanced token management,
    MAESTRO security framework, and multi-agent orchestration patterns.
    
    **Key Enhancements:**
    - Protocol interoperability (MCP, Agent2Agent, AITP)
    - Advanced token management with tiktoken integration
    - MAESTRO security framework
    - Multi-agent orchestration patterns
    - ISO 42001:2023 governance compliance
    - Healthcare domain specialization
    - Comprehensive testing and observability
    
    Based on extensive research of enterprise AI agent implementations including
    Microsoft's healthcare orchestrator and PG&E's smart grid systems.
    
  contact:
    name: OpenAPI AI Agents Standard Consortium
    url: https://github.com/openapi-ai-agents/standard
    email: standards@openapi-ai-agents.org
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.llm-platform.io/v2
    description: Production API server with full enterprise features
  - url: https://staging-api.llm-platform.io/v2
    description: Staging environment for testing
  - url: http://localhost:4000/api/v2
    description: Local development server

# Enhanced security schemes
security:
  - OAuth2PKCE: []
  - MutualTLS: []
  - APIKeyRotation: []

paths:
  # Core Agent Orchestration
  /agent/orchestrate/enhanced:
    post:
      operationId: enhancedAgentOrchestrate
      summary: Enhanced multi-agent orchestration with protocol negotiation
      description: |
        Deploy and coordinate multiple specialized agents with support for:
        - Protocol negotiation (MCP, A2A, OpenAPI)
        - Advanced token management and cost optimization
        - Real-time monitoring and health checks
        - Automatic fallback and recovery strategies
        
      tags:
        - Agent Orchestration
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EnhancedOrchestrationRequest'
            examples:
              healthcare_diagnosis:
                summary: Healthcare diagnostic workflow
                value:
                  orchestration_pattern: "diagnostic_first"
                  domain: "healthcare"
                  compliance_level: "hipaa"
                  agents:
                    - type: "medical_imaging_analyzer"
                      capabilities: ["radiology", "pathology"]
                      certification: "fda_cleared"
                    - type: "clinical_decision_support"
                      capabilities: ["differential_diagnosis", "treatment_planning"]
                  token_budget:
                    max_tokens: 50000
                    cost_limit_usd: 25.0
                  security:
                    phi_protection: true
                    audit_level: "comprehensive"
                    
      responses:
        '200':
          description: Orchestration initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnhancedOrchestrationResponse'
              examples:
                success_response:
                  summary: Successful orchestration response
                  value:
                    orchestration_id: "orch_healthcare_20240127_001"
                    status: "running"
                    agents_deployed: 3
                    estimated_completion_time: "2024-01-27T15:30:00Z"
                    token_usage:
                      allocated: 50000
                      used: 1250
                      estimated_total: 12000
                    security:
                      encryption: "AES-256-GCM"
                      audit_trail_id: "audit_20240127_001"
                    monitoring:
                      dashboard_url: "https://dashboard.llm-platform.io/orch/healthcare_001"
                      
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # Protocol Bridge Endpoints
  /protocols/mcp/bridge:
    post:
      operationId: mcpBridge
      summary: Bridge OpenAPI agents to MCP protocol
      description: |
        Convert OpenAPI agent interactions to Model Context Protocol (MCP) format
        enabling seamless integration with MCP-native tools and resources.
        
      tags:
        - Protocol Interoperability
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MCPBridgeRequest'
              
      responses:
        '200':
          description: MCP bridge established
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MCPBridgeResponse'

  /protocols/a2a/negotiate:
    post:
      operationId: a2aNegotiate
      summary: Negotiate Agent-to-Agent communication protocol
      description: |
        Establish direct agent-to-agent communication using Google's A2A protocol
        for scenarios requiring low-latency direct agent collaboration.
        
      tags:
        - Protocol Interoperability
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/A2ANegotiationRequest'
              
      responses:
        '200':
          description: A2A protocol negotiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/A2ANegotiationResponse'

  # Advanced Token Management
  /tokens/preflight/enhanced:
    post:
      operationId: enhancedTokenPreflight
      summary: Enhanced token pre-flight check with tiktoken integration
      description: |
        Perform comprehensive token analysis using tiktoken for precise counting,
        cost estimation, optimization suggestions, and budget validation.
        
      tags:
        - Token Management
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EnhancedTokenPreflightRequest'
            examples:
              clinical_analysis:
                summary: Clinical text analysis request
                value:
                  text: "Patient presents with chest pain, shortness of breath..."
                  model: "gpt-4-turbo"
                  encoding: "o200k_base"
                  optimization_level: "aggressive"
                  budget_constraints:
                    max_cost_usd: 5.0
                    max_tokens: 8000
                  domain_context: "healthcare"
                  
      responses:
        '200':
          description: Token pre-flight analysis complete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnhancedTokenPreflightResponse'
              examples:
                analysis_result:
                  summary: Token analysis result
                  value:
                    approved: true
                    token_count: 1247
                    encoding_used: "o200k_base"
                    estimated_cost: 2.34
                    optimization:
                      applied: true
                      original_tokens: 1890
                      compressed_tokens: 1247
                      compression_ratio: 0.66
                      techniques: ["semantic_compression", "medical_abbreviations"]
                    budget_status:
                      within_limits: true
                      remaining_budget: 2.66
                      utilization_percent: 46.8
                    recommendations:
                      - "Consider using domain-specific medical model"
                      - "Enable streaming for long responses"

  # Multi-Agent Orchestration Status
  /orchestration/{orchestrationId}/status/detailed:
    get:
      operationId: getDetailedOrchestrationStatus
      summary: Get detailed orchestration status with agent-level metrics
      description: |
        Retrieve comprehensive status information including agent performance,
        token usage, security compliance, and orchestration health metrics.
        
      tags:
        - Agent Monitoring
        
      parameters:
        - name: orchestrationId
          in: path
          required: true
          schema:
            type: string
          example: "orch_healthcare_20240127_001"
          
        - name: include_metrics
          in: query
          description: Include detailed performance metrics
          schema:
            type: boolean
            default: true
            
        - name: include_audit
          in: query
          description: Include audit trail information
          schema:
            type: boolean
            default: false
            
      responses:
        '200':
          description: Detailed orchestration status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailedOrchestrationStatus'

  # Governance and Compliance
  /governance/compliance/validate:
    post:
      operationId: validateCompliance
      summary: Validate agent compliance with governance frameworks
      description: |
        Comprehensive compliance validation against multiple frameworks:
        ISO 42001:2023, NIST AI RMF 1.0, EU AI Act, and domain-specific regulations.
        
      tags:
        - Governance
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComplianceValidationRequest'
              
      responses:
        '200':
          description: Compliance validation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComplianceValidationResponse'

  # Security and Threat Assessment
  /security/maestro/assess:
    post:
      operationId: maestroThreatAssessment
      summary: MAESTRO framework threat assessment
      description: |
        Comprehensive threat assessment using the MAESTRO framework specifically
        designed for Agentic AI systems, covering model extraction, poisoning,
        and compliance risks.
        
      tags:
        - Security
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MAESTROAssessmentRequest'
              
      responses:
        '200':
          description: MAESTRO threat assessment results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MAESTROAssessmentResponse'

  # Advanced Testing Endpoints
  /testing/contract/validate:
    post:
      operationId: validateContract
      summary: Validate agent contract compatibility
      description: |
        Perform contract testing between agents using consumer-driven contracts
        to ensure API compatibility and prevent integration failures.
        
      tags:
        - Testing
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContractValidationRequest'
              
      responses:
        '200':
          description: Contract validation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractValidationResponse'

  /testing/chaos/simulate:
    post:
      operationId: simulateChaosScenario
      summary: Simulate chaos engineering scenarios
      description: |
        Execute chaos engineering scenarios to test agent resilience
        including network failures, resource exhaustion, and agent crashes.
        
      tags:
        - Testing
        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChaosSimulationRequest'
              
      responses:
        '200':
          description: Chaos simulation initiated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChaosSimulationResponse'

  # Health and Observability
  /health/comprehensive:
    get:
      operationId: getComprehensiveHealth
      summary: Comprehensive system health check
      description: |
        Multi-dimensional health check covering:
        - Agent system health
        - Token management systems
        - Security posture
        - Compliance status
        - Performance metrics
        - Resource utilization
        
      tags:
        - Health & Observability
        
      responses:
        '200':
          description: Comprehensive health status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComprehensiveHealthStatus'
        '503':
          description: System unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComprehensiveHealthStatus'

components:
  securitySchemes:
    OAuth2PKCE:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: https://auth.llm-platform.io/oauth2/authorize
          tokenUrl: https://auth.llm-platform.io/oauth2/token
          scopes:
            agent:orchestrate: Orchestrate multiple agents
            agent:monitor: Monitor agent performance
            tokens:manage: Manage token usage and optimization
            governance:validate: Validate compliance
            security:assess: Perform security assessments
            
    MutualTLS:
      type: mutualTLS
      
    APIKeyRotation:
      type: apiKey
      in: header
      name: X-API-Key
      description: Rotating API key with 24-hour lifecycle

  schemas:
    # Enhanced Orchestration Schemas
    EnhancedOrchestrationRequest:
      type: object
      required:
        - orchestration_pattern
        - agents
        - token_budget
      properties:
        orchestration_pattern:
          type: string
          enum: [diagnostic_first, parallel_validation, magentic_orchestration]
          description: Orchestration pattern to use
        domain:
          type: string
          enum: [healthcare, financial_services, manufacturing, retail]
          description: Domain specialization
        compliance_level:
          type: string
          enum: [basic, standard, strict, healthcare_hipaa, financial_sox]
        agents:
          type: array
          items:
            $ref: '#/components/schemas/EnhancedAgentSpec'
        token_budget:
          $ref: '#/components/schemas/TokenBudget'
        security:
          $ref: '#/components/schemas/SecurityRequirements'
        monitoring:
          $ref: '#/components/schemas/MonitoringConfig'

    EnhancedAgentSpec:
      type: object
      required:
        - type
        - capabilities
      properties:
        type:
          type: string
          description: Agent type identifier
        capabilities:
          type: array
          items:
            type: string
          description: Required capabilities
        certification:
          type: string
          enum: [fda_cleared, iso_certified, hipaa_compliant]
          description: Required certifications
        resource_limits:
          $ref: '#/components/schemas/ResourceLimits'
        protocols:
          type: array
          items:
            type: string
            enum: [openapi, mcp, a2a, aitp]
          description: Supported protocols

    TokenBudget:
      type: object
      required:
        - max_tokens
        - cost_limit_usd
      properties:
        max_tokens:
          type: integer
          minimum: 1000
          maximum: 200000
          description: Maximum tokens for entire orchestration
        cost_limit_usd:
          type: number
          minimum: 0.01
          maximum: 1000.0
          description: Maximum cost in USD
        optimization_strategy:
          type: string
          enum: [conservative, balanced, aggressive]
          default: balanced
        encoding:
          type: string
          enum: [cl100k_base, o200k_base, p50k_base]
          default: o200k_base

    SecurityRequirements:
      type: object
      properties:
        phi_protection:
          type: boolean
          description: Protected Health Information protection
        pii_detection:
          type: boolean
          description: Personally Identifiable Information detection
        audit_level:
          type: string
          enum: [basic, standard, comprehensive, forensic]
        encryption:
          type: string
          enum: [AES-256-GCM, ChaCha20-Poly1305]
        threat_model:
          type: string
          enum: [MAESTRO, STRIDE, DREAD]

    # Protocol Bridge Schemas
    MCPBridgeRequest:
      type: object
      required:
        - agent_endpoint
        - mcp_version
      properties:
        agent_endpoint:
          type: string
          format: uri
          description: OpenAPI agent endpoint
        mcp_version:
          type: string
          enum: ["1.0", "1.1"]
          description: MCP protocol version
        tools:
          type: array
          items:
            $ref: '#/components/schemas/MCPTool'
        resources:
          type: array
          items:
            $ref: '#/components/schemas/MCPResource'

    MCPTool:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        input_schema:
          type: object
          description: JSON Schema for tool input

    # Enhanced Token Management Schemas
    EnhancedTokenPreflightRequest:
      type: object
      required:
        - text
        - model
      properties:
        text:
          type: string
          maxLength: 1000000
          description: Text to analyze for tokens
        model:
          type: string
          enum: [gpt-4-turbo, gpt-4o, claude-3-opus, claude-3-sonnet, claude-3-haiku]
        encoding:
          type: string
          enum: [cl100k_base, o200k_base, p50k_base]
          default: o200k_base
        optimization_level:
          type: string
          enum: [none, conservative, balanced, aggressive]
          default: balanced
        budget_constraints:
          $ref: '#/components/schemas/BudgetConstraints'
        domain_context:
          type: string
          enum: [general, healthcare, legal, financial, technical]

    EnhancedTokenPreflightResponse:
      type: object
      properties:
        approved:
          type: boolean
          description: Whether the request is approved
        token_count:
          type: integer
          description: Exact token count using tiktoken
        encoding_used:
          type: string
          description: Encoding algorithm used
        estimated_cost:
          type: number
          description: Estimated cost in USD
        optimization:
          $ref: '#/components/schemas/OptimizationResult'
        budget_status:
          $ref: '#/components/schemas/BudgetStatus'
        recommendations:
          type: array
          items:
            type: string
          description: Optimization recommendations
        security_analysis:
          $ref: '#/components/schemas/SecurityAnalysis'

    # Governance and Compliance Schemas
    ComplianceValidationRequest:
      type: object
      required:
        - frameworks
        - agent_config
      properties:
        frameworks:
          type: array
          items:
            type: string
            enum: [ISO_42001_2023, NIST_AI_RMF_1_0, EU_AI_Act, HIPAA, SOX, GDPR]
        agent_config:
          type: object
          description: Agent configuration to validate
        domain:
          type: string
          description: Application domain
        risk_level:
          type: string
          enum: [minimal, limited, high, unacceptable]

    ComplianceValidationResponse:
      type: object
      properties:
        overall_compliance:
          type: string
          enum: [compliant, non_compliant, conditional]
        framework_results:
          type: array
          items:
            $ref: '#/components/schemas/FrameworkComplianceResult'
        recommendations:
          type: array
          items:
            $ref: '#/components/schemas/ComplianceRecommendation'
        certification_eligibility:
          $ref: '#/components/schemas/CertificationEligibility'

    # MAESTRO Security Assessment Schemas
    MAESTROAssessmentRequest:
      type: object
      required:
        - agent_architecture
        - deployment_environment
      properties:
        agent_architecture:
          $ref: '#/components/schemas/AgentArchitecture'
        deployment_environment:
          type: string
          enum: [cloud, hybrid, on_premises, edge]
        threat_categories:
          type: array
          items:
            type: string
            enum: [model_extraction, data_poisoning, prompt_injection, compliance_violations]

    MAESTROAssessmentResponse:
      type: object
      properties:
        overall_risk_score:
          type: number
          minimum: 0
          maximum: 10
          description: Overall risk score (0 = minimal risk, 10 = critical)
        threat_analysis:
          type: array
          items:
            $ref: '#/components/schemas/ThreatAnalysis'
        mitigation_strategies:
          type: array
          items:
            $ref: '#/components/schemas/MitigationStrategy'
        compliance_gaps:
          type: array
          items:
            $ref: '#/components/schemas/ComplianceGap'

    # Comprehensive Health Status
    ComprehensiveHealthStatus:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy, critical]
        uptime_seconds:
          type: number
          description: System uptime in seconds
        component_health:
          type: object
          properties:
            agent_orchestrator:
              $ref: '#/components/schemas/ComponentHealth'
            token_management:
              $ref: '#/components/schemas/ComponentHealth'
            security_systems:
              $ref: '#/components/schemas/ComponentHealth'
            protocol_bridges:
              $ref: '#/components/schemas/ComponentHealth'
        performance_metrics:
          $ref: '#/components/schemas/PerformanceMetrics'
        compliance_status:
          $ref: '#/components/schemas/ComplianceStatus'
        security_posture:
          $ref: '#/components/schemas/SecurityPosture'

    # Supporting schemas
    ResourceLimits:
      type: object
      properties:
        cpu_cores:
          type: number
        memory_gb:
          type: number
        gpu_units:
          type: integer
        timeout_seconds:
          type: integer

    OptimizationResult:
      type: object
      properties:
        applied:
          type: boolean
        original_tokens:
          type: integer
        compressed_tokens:
          type: integer
        compression_ratio:
          type: number
        techniques:
          type: array
          items:
            type: string

    BudgetStatus:
      type: object
      properties:
        within_limits:
          type: boolean
        remaining_budget:
          type: number
        utilization_percent:
          type: number

    SecurityAnalysis:
      type: object
      properties:
        pii_detected:
          type: boolean
        phi_detected:
          type: boolean
        sensitive_patterns:
          type: array
          items:
            type: string
        risk_level:
          type: string
          enum: [low, medium, high, critical]

  responses:
    BadRequest:
      description: Bad request - validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    
    Unauthorized:
      description: Unauthorized - authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    
    RateLimited:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
      headers:
        Retry-After:
          schema:
            type: integer
          description: Seconds to wait before retrying

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Error:
      type: object
      required:
        - message
        - code
      properties:
        message:
          type: string
          description: Human-readable error message
        code:
          type: string
          description: Machine-readable error code
        details:
          type: object
          description: Additional error details
        timestamp:
          type: string
          format: date-time
        request_id:
          type: string
          description: Unique request identifier for tracing
        remediation:
          type: array
          items:
            type: string
          description: Suggested remediation steps

# Enhanced webhook support
webhooks:
  orchestrationStatusUpdate:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrchestrationStatusUpdate'
      responses:
        '200':
          description: Webhook processed successfully

  securityAlert:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SecurityAlert'
      responses:
        '200':
          description: Security alert processed

  complianceViolation:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComplianceViolation'
      responses:
        '200':
          description: Compliance violation processed

# OpenAPI Extensions for AI Agents
x-ai-agent-standard:
  version: "2.1.0"
  certification: "gold"
  compliance_frameworks:
    - ISO_42001_2023
    - NIST_AI_RMF_1_0
    - EU_AI_Act
  
x-token-optimization:
  enabled: true
  tiktoken_integration: true
  budget_monitoring: true
  
x-protocol-interoperability:
  mcp_support: true
  a2a_support: true
  auto_negotiation: true
  
x-security-framework:
  threat_model: "MAESTRO"
  authentication: "multi_factor"
  authorization: "rbac_with_attributes"
  
x-observability:
  metrics_enabled: true
  tracing_enabled: true
  audit_logging: true