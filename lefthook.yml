commit-msg:
  commands:
    claude-protection:
      run: |
        COMMIT_MSG_FILE="$1"
        if [ -z "$COMMIT_MSG_FILE" ]; then
          COMMIT_MSG_FILE=".git/COMMIT_EDITMSG"
        fi

        if [ ! -f "$COMMIT_MSG_FILE" ]; then
          echo "âš ï¸ Could not find commit message file: $COMMIT_MSG_FILE"
          exit 0
        fi

        COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

        # Forbidden patterns that should NEVER appear in commit messages
        if echo "$COMMIT_MSG" | grep -qi "Generated with.*Claude\|Co-Authored-By:.*Claude\|ğŸ¤–\|claude.ai/code\|noreply@anthropic.com"; then
          echo ""
          echo "ğŸš« COMMIT BLOCKED: Forbidden Claude/AI attribution detected!"
          echo "   âŒ NO 'Generated with Claude Code'"
          echo "   âŒ NO 'Co-Authored-By: Claude'"
          echo "   âŒ NO ğŸ¤– emoji"
          echo "   âŒ NO AI/Claude references"
          echo ""
          echo "   âœ… Write as the human developer"
          echo "   âœ… Use professional technical language"
          echo ""
          exit 1
        fi

pre-commit:
  commands:
    format:
      run: |
        if [ -f "package.json" ] && command -v npm >/dev/null 2>&1; then
          if npm run format >/dev/null 2>&1; then
            npm run format
          fi
        fi
      root: "."
      stage_fixed: true
      skip:
        - merge
        - rebase
    lint:
      run: |
        if [ -f "package.json" ] && command -v npm >/dev/null 2>&1; then
          if npm run lint >/dev/null 2>&1; then
            npm run lint
          fi
        fi
      root: "."
      files: git diff --cached --name-only --diff-filter=ACM
      skip:
        - merge
        - rebase

pre-push:
  commands:
    test:
      run: |
        if [ -f "package.json" ] && command -v npm >/dev/null 2>&1; then
          if npm test >/dev/null 2>&1; then
            npm test
          fi
        fi
      root: "."
      skip:
        - merge
        - rebase
    security-audit:
      run: |
        if [ -f "package.json" ] && command -v npm >/dev/null 2>&1; then
          npm audit --audit-level=moderate || true
        fi
      root: "."
      skip:
        - merge
        - rebase