{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ossa.io/schemas/v0.1.9/agent.json",
  "title": "OSSA v0.1.9 Agent Manifest Schema",
  "description": "Open Standard for Scalable Agents (OSSA) - The OpenAPI for AI Agents. Specification for declarative agent definition with framework-agnostic portability.",
  "type": "object",
  "required": [
    "apiVersion",
    "kind",
    "metadata",
    "spec"
  ],
  "properties": {
    "apiVersion": {
      "type": "string",
      "pattern": "^ossa/v\\d+(\\.\\d+)?(\\.\\d+)?(-[a-zA-Z0-9]+)?$",
      "description": "OSSA API version (semver format with 'ossa/' prefix)",
      "examples": [
        "ossa/v1",
        "ossa/v0.1.9",
        "ossa/v0.1.9-alpha.1"
      ]
    },
    "kind": {
      "type": "string",
      "enum": [
        "Agent"
      ],
      "description": "Resource type - currently only 'Agent' is supported"
    },
    "metadata": {
      "$ref": "#/definitions/Metadata"
    },
    "spec": {
      "$ref": "#/definitions/AgentSpec"
    },
    "extensions": {
      "type": "object",
      "description": "Framework-specific extensions (e.g., kagent, langchain, crewai)",
      "additionalProperties": true,
      "examples": [
        {
          "kagent": {
            "kubernetes": {
              "namespace": "production",
              "labels": {
                "app": "my-agent"
              }
            }
          }
        }
      ]
    }
  },
  "additionalProperties": false,
  "definitions": {
    "Metadata": {
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
          "maxLength": 253,
          "description": "Agent identifier (DNS-1123 subdomain format for Kubernetes compatibility)"
        },
        "version": {
          "type": "string",
          "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
          "description": "Semantic version (semver 2.0.0)"
        },
        "description": {
          "type": "string",
          "maxLength": 2000,
          "description": "Human-readable description of agent purpose and capabilities"
        },
        "labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string",
            "maxLength": 63
          },
          "description": "Key-value labels for organization and filtering"
        },
        "annotations": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Arbitrary metadata for tooling (not used for filtering)"
        }
      },
      "additionalProperties": false
    },
    "AgentSpec": {
      "type": "object",
      "required": [
        "role"
      ],
      "properties": {
        "taxonomy": {
          "$ref": "#/definitions/Taxonomy"
        },
        "role": {
          "type": "string",
          "minLength": 1,
          "description": "Agent role/system prompt describing behavior and capabilities"
        },
        "llm": {
          "$ref": "#/definitions/LLMConfig"
        },
        "tools": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Tool"
          },
          "description": "Available tools/capabilities for the agent"
        },
        "autonomy": {
          "$ref": "#/definitions/Autonomy"
        },
        "constraints": {
          "$ref": "#/definitions/Constraints"
        },
        "observability": {
          "$ref": "#/definitions/Observability"
        }
      },
      "additionalProperties": true
    },
    "Taxonomy": {
      "type": "object",
      "required": [
        "domain"
      ],
      "properties": {
        "domain": {
          "type": "string",
          "description": "Primary domain classification",
          "examples": [
            "infrastructure",
            "security",
            "compliance",
            "documentation"
          ]
        },
        "subdomain": {
          "type": "string",
          "description": "Secondary classification within domain",
          "examples": [
            "kubernetes",
            "vulnerability",
            "generation"
          ]
        },
        "capability": {
          "type": "string",
          "description": "Specific capability or function",
          "examples": [
            "troubleshooting",
            "scanning",
            "optimization"
          ]
        }
      },
      "additionalProperties": false
    },
    "LLMConfig": {
      "type": "object",
      "required": [
        "provider",
        "model"
      ],
      "properties": {
        "provider": {
          "type": "string",
          "enum": [
            "openai",
            "anthropic",
            "google",
            "azure",
            "ollama",
            "custom"
          ],
          "description": "LLM provider"
        },
        "model": {
          "type": "string",
          "description": "Model identifier",
          "examples": [
            "gpt-4",
            "claude-3-sonnet-20240229",
            "gemini-pro"
          ]
        },
        "temperature": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "description": "Sampling temperature for response generation"
        },
        "maxTokens": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum tokens per request"
        },
        "topP": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Nucleus sampling parameter"
        },
        "frequencyPenalty": {
          "type": "number",
          "minimum": -2,
          "maximum": 2,
          "description": "Frequency penalty for token generation"
        },
        "presencePenalty": {
          "type": "number",
          "minimum": -2,
          "maximum": 2,
          "description": "Presence penalty for token generation"
        }
      },
      "additionalProperties": false
    },
    "Tool": {
      "type": "object",
      "required": [
        "type"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "mcp",
            "kubernetes",
            "http",
            "grpc",
            "function",
            "custom"
          ],
          "description": "Tool integration type"
        },
        "name": {
          "type": "string",
          "description": "Tool name/identifier"
        },
        "server": {
          "type": "string",
          "description": "MCP server name (for type=mcp)"
        },
        "namespace": {
          "type": "string",
          "description": "Kubernetes namespace (for type=kubernetes or mcp)"
        },
        "endpoint": {
          "type": "string",
          "format": "uri",
          "description": "HTTP/gRPC endpoint (for type=http/grpc)"
        },
        "capabilities": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Specific capabilities/operations from this tool"
        },
        "config": {
          "type": "object",
          "description": "Tool-specific configuration",
          "additionalProperties": true
        },
        "auth": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "bearer",
                "oauth2",
                "mtls",
                "apikey",
                "none"
              ]
            },
            "credentials": {
              "type": "string",
              "description": "Reference to secret/credential (not the actual secret)"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "Autonomy": {
      "type": "object",
      "properties": {
        "level": {
          "type": "string",
          "enum": [
            "supervised",
            "autonomous",
            "fully_autonomous"
          ],
          "description": "Level of autonomy for agent decision-making"
        },
        "approval_required": {
          "type": "boolean",
          "description": "Whether human approval is required for actions"
        },
        "allowed_actions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Whitelist of permitted actions"
        },
        "blocked_actions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Blacklist of forbidden actions"
        },
        "escalation_policy": {
          "type": "object",
          "description": "Rules for escalating to human oversight"
        }
      },
      "additionalProperties": false
    },
    "Constraints": {
      "type": "object",
      "properties": {
        "cost": {
          "type": "object",
          "properties": {
            "maxTokensPerDay": {
              "type": "integer",
              "minimum": 0
            },
            "maxTokensPerRequest": {
              "type": "integer",
              "minimum": 0
            },
            "maxCostPerDay": {
              "type": "number",
              "minimum": 0
            },
            "currency": {
              "type": "string",
              "pattern": "^[A-Z]{3}$",
              "default": "USD"
            }
          }
        },
        "performance": {
          "type": "object",
          "properties": {
            "maxLatencySeconds": {
              "type": "number",
              "minimum": 0
            },
            "maxConcurrentRequests": {
              "type": "integer",
              "minimum": 1
            },
            "timeoutSeconds": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "resources": {
          "type": "object",
          "properties": {
            "cpu": {
              "type": "string",
              "description": "CPU limit (Kubernetes format: 100m, 1, 2.5)"
            },
            "memory": {
              "type": "string",
              "description": "Memory limit (Kubernetes format: 128Mi, 1Gi)"
            },
            "gpu": {
              "type": "string",
              "description": "GPU requirement"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "Observability": {
      "type": "object",
      "properties": {
        "tracing": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "exporter": {
              "type": "string",
              "enum": [
                "otlp",
                "jaeger",
                "zipkin",
                "custom"
              ]
            },
            "endpoint": {
              "type": "string",
              "format": "uri"
            }
          }
        },
        "metrics": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "exporter": {
              "type": "string",
              "enum": [
                "prometheus",
                "otlp",
                "custom"
              ]
            },
            "endpoint": {
              "type": "string",
              "format": "uri"
            }
          }
        },
        "logging": {
          "type": "object",
          "properties": {
            "level": {
              "type": "string",
              "enum": [
                "debug",
                "info",
                "warn",
                "error"
              ],
              "default": "info"
            },
            "format": {
              "type": "string",
              "enum": [
                "json",
                "text"
              ],
              "default": "json"
            }
          }
        }
      },
      "additionalProperties": false
    }
  }
}
