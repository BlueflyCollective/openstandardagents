{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://open-standards-scalable-agents.org/schemas/v0.1.3/extensions/x-ossa-memory-system.json",
  "title": "OSSA Memory System Extension",
  "description": "Hierarchical memory management with hot/warm/cold tiers for OSSA agents",
  "type": "object",
  "properties": {
    "x-ossa-memory-system": {
      "type": "object",
      "required": ["hierarchicalStorage", "tiers", "persistence"],
      "properties": {
        "hierarchicalStorage": {
          "type": "object",
          "required": ["enabled", "strategy", "optimization"],
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable hierarchical memory management"
            },
            "strategy": {
              "type": "string",
              "enum": ["frequency_based", "recency_based", "hybrid", "ml_guided"],
              "default": "hybrid",
              "description": "Memory tier allocation strategy"
            },
            "optimization": {
              "type": "object",
              "properties": {
                "autoTierManagement": {
                  "type": "boolean",
                  "default": true,
                  "description": "Automatically manage memory tier allocations"
                },
                "compressionEnabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable memory compression in cold tier"
                },
                "migrationPolicy": {
                  "type": "string",
                  "enum": ["aggressive", "conservative", "balanced", "adaptive"],
                  "default": "balanced",
                  "description": "Memory tier migration policy"
                }
              }
            }
          }
        },
        "tiers": {
          "type": "object",
          "required": ["hot", "warm", "cold"],
          "properties": {
            "hot": {
              "type": "object",
              "required": ["capacity", "accessTime", "retention"],
              "properties": {
                "capacity": {
                  "type": "object",
                  "properties": {
                    "maxSize": {
                      "type": "string",
                      "pattern": "^[0-9]+(\\.[0-9]+)?[KMGT]B$",
                      "default": "512MB",
                      "description": "Maximum hot tier memory size"
                    },
                    "maxItems": {
                      "type": "integer",
                      "minimum": 100,
                      "maximum": 100000,
                      "default": 10000,
                      "description": "Maximum items in hot tier"
                    }
                  }
                },
                "accessTime": {
                  "type": "object",
                  "properties": {
                    "target": {
                      "type": "string",
                      "pattern": "^[0-9]+(\\.[0-9]+)?[mun]s$",
                      "default": "1ms",
                      "description": "Target access time for hot tier"
                    },
                    "sla": {
                      "type": "string",
                      "pattern": "^[0-9]+(\\.[0-9]+)?[mun]s$",
                      "default": "5ms",
                      "description": "SLA access time guarantee"
                    }
                  }
                },
                "retention": {
                  "type": "object",
                  "properties": {
                    "policy": {
                      "type": "string",
                      "enum": ["lru", "lfu", "fifo", "adaptive"],
                      "default": "adaptive",
                      "description": "Hot tier retention policy"
                    },
                    "ttl": {
                      "type": "string",
                      "pattern": "^[0-9]+[smhd]$",
                      "default": "1h",
                      "description": "Hot tier time-to-live"
                    }
                  }
                }
              }
            },
            "warm": {
              "type": "object",
              "required": ["capacity", "accessTime", "retention"],
              "properties": {
                "capacity": {
                  "type": "object",
                  "properties": {
                    "maxSize": {
                      "type": "string",
                      "pattern": "^[0-9]+(\\.[0-9]+)?[KMGT]B$",
                      "default": "2GB",
                      "description": "Maximum warm tier memory size"
                    },
                    "maxItems": {
                      "type": "integer",
                      "minimum": 1000,
                      "maximum": 1000000,
                      "default": 100000,
                      "description": "Maximum items in warm tier"
                    }
                  }
                },
                "accessTime": {
                  "type": "object",
                  "properties": {
                    "target": {
                      "type": "string",
                      "pattern": "^[0-9]+(\\.[0-9]+)?[mun]s$",
                      "default": "10ms",
                      "description": "Target access time for warm tier"
                    },
                    "sla": {
                      "type": "string",
                      "pattern": "^[0-9]+(\\.[0-9]+)?[mun]s$",
                      "default": "50ms",
                      "description": "SLA access time guarantee"
                    }
                  }
                },
                "retention": {
                  "type": "object",
                  "properties": {
                    "policy": {
                      "type": "string",
                      "enum": ["age_based", "frequency_based", "size_based", "adaptive"],
                      "default": "adaptive",
                      "description": "Warm tier retention policy"
                    },
                    "ttl": {
                      "type": "string",
                      "pattern": "^[0-9]+[smhd]$",
                      "default": "24h",
                      "description": "Warm tier time-to-live"
                    }
                  }
                }
              }
            },
            "cold": {
              "type": "object",
              "required": ["capacity", "accessTime", "retention"],
              "properties": {
                "capacity": {
                  "type": "object",
                  "properties": {
                    "maxSize": {
                      "type": "string",
                      "pattern": "^[0-9]+(\\.[0-9]+)?[KMGT]B$",
                      "default": "10GB",
                      "description": "Maximum cold tier memory size"
                    },
                    "maxItems": {
                      "type": "integer",
                      "minimum": 10000,
                      "maximum": 10000000,
                      "default": 1000000,
                      "description": "Maximum items in cold tier"
                    }
                  }
                },
                "accessTime": {
                  "type": "object",
                  "properties": {
                    "target": {
                      "type": "string",
                      "pattern": "^[0-9]+(\\.[0-9]+)?[mun]s$",
                      "default": "100ms",
                      "description": "Target access time for cold tier"
                    },
                    "sla": {
                      "type": "string",
                      "pattern": "^[0-9]+(\\.[0-9]+)?[mun]s$",
                      "default": "500ms",
                      "description": "SLA access time guarantee"
                    }
                  }
                },
                "retention": {
                  "type": "object",
                  "properties": {
                    "policy": {
                      "type": "string",
                      "enum": ["permanent", "archive", "compress", "adaptive"],
                      "default": "compress",
                      "description": "Cold tier retention policy"
                    },
                    "ttl": {
                      "type": "string",
                      "pattern": "^[0-9]+[dwmy]$",
                      "default": "30d",
                      "description": "Cold tier time-to-live"
                    }
                  }
                }
              }
            }
          }
        },
        "persistence": {
          "type": "object",
          "required": ["contextGraphs", "vectorStorage", "semanticFidelity"],
          "properties": {
            "contextGraphs": {
              "type": "object",
              "required": ["enabled", "storage", "optimization"],
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable persistent context graphs"
                },
                "storage": {
                  "type": "object",
                  "properties": {
                    "provider": {
                      "type": "string",
                      "enum": ["qdrant", "neo4j", "redis_graph", "memory"],
                      "default": "qdrant",
                      "description": "Context graph storage provider"
                    },
                    "indexing": {
                      "type": "string",
                      "enum": ["graph", "vector", "hybrid"],
                      "default": "hybrid",
                      "description": "Context graph indexing strategy"
                    },
                    "compression": {
                      "type": "boolean",
                      "default": true,
                      "description": "Enable context graph compression"
                    }
                  }
                },
                "optimization": {
                  "type": "object",
                  "properties": {
                    "pruning": {
                      "type": "object",
                      "properties": {
                        "enabled": {
                          "type": "boolean",
                          "default": true
                        },
                        "strategy": {
                          "type": "string",
                          "enum": ["importance_based", "time_based", "frequency_based", "hybrid"],
                          "default": "hybrid"
                        },
                        "threshold": {
                          "type": "number",
                          "minimum": 0.1,
                          "maximum": 0.9,
                          "default": 0.3,
                          "description": "Pruning threshold for importance scoring"
                        }
                      }
                    },
                    "clustering": {
                      "type": "object",
                      "properties": {
                        "enabled": {
                          "type": "boolean",
                          "default": true
                        },
                        "algorithm": {
                          "type": "string",
                          "enum": ["kmeans", "dbscan", "hierarchical", "graph_community"],
                          "default": "graph_community"
                        },
                        "similarity_threshold": {
                          "type": "number",
                          "minimum": 0.5,
                          "maximum": 0.99,
                          "default": 0.85
                        }
                      }
                    }
                  }
                }
              }
            },
            "vectorStorage": {
              "type": "object",
              "required": ["provider", "configuration"],
              "properties": {
                "provider": {
                  "type": "string",
                  "enum": ["qdrant", "pinecone", "weaviate", "chroma"],
                  "default": "qdrant",
                  "description": "Vector storage provider (aligned with Drupal integration)"
                },
                "configuration": {
                  "type": "object",
                  "properties": {
                    "dimensions": {
                      "type": "integer",
                      "minimum": 128,
                      "maximum": 4096,
                      "default": 1536,
                      "description": "Vector dimensions for embeddings"
                    },
                    "distance": {
                      "type": "string",
                      "enum": ["cosine", "euclidean", "dot_product"],
                      "default": "cosine",
                      "description": "Distance metric for vector similarity"
                    },
                    "indexing": {
                      "type": "object",
                      "properties": {
                        "algorithm": {
                          "type": "string",
                          "enum": ["hnsw", "ivf", "flat"],
                          "default": "hnsw"
                        },
                        "parameters": {
                          "type": "object",
                          "properties": {
                            "m": {
                              "type": "integer",
                              "minimum": 4,
                              "maximum": 64,
                              "default": 16,
                              "description": "HNSW M parameter"
                            },
                            "ef_construct": {
                              "type": "integer",
                              "minimum": 16,
                              "maximum": 512,
                              "default": 200,
                              "description": "HNSW ef_construct parameter"
                            }
                          }
                        }
                      }
                    },
                    "replication": {
                      "type": "object",
                      "properties": {
                        "enabled": {
                          "type": "boolean",
                          "default": true
                        },
                        "factor": {
                          "type": "integer",
                          "minimum": 1,
                          "maximum": 5,
                          "default": 2,
                          "description": "Replication factor for high availability"
                        }
                      }
                    }
                  }
                }
              }
            },
            "semanticFidelity": {
              "type": "object",
              "required": ["target", "monitoring", "preservation"],
              "properties": {
                "target": {
                  "type": "number",
                  "minimum": 0.90,
                  "maximum": 1.0,
                  "default": 0.95,
                  "description": "Target semantic fidelity preservation (95%+)"
                },
                "monitoring": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true
                    },
                    "metrics": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "enum": ["cosine_similarity", "semantic_entropy", "information_loss", "retrieval_accuracy"]
                      },
                      "default": ["cosine_similarity", "semantic_entropy", "retrieval_accuracy"]
                    },
                    "threshold": {
                      "type": "number",
                      "minimum": 0.8,
                      "maximum": 0.99,
                      "default": 0.92,
                      "description": "Alert threshold for fidelity degradation"
                    }
                  }
                },
                "preservation": {
                  "type": "object",
                  "properties": {
                    "techniques": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "enum": ["differential_encoding", "lossy_compression", "selective_retention", "semantic_hashing"]
                      },
                      "default": ["differential_encoding", "selective_retention"]
                    },
                    "adaptiveThreshold": {
                      "type": "boolean",
                      "default": true,
                      "description": "Adapt preservation techniques based on content importance"
                    }
                  }
                }
              }
            }
          }
        },
        "performance": {
          "type": "object",
          "properties": {
            "targets": {
              "type": "object",
              "properties": {
                "tierMigrationLatency": {
                  "type": "string",
                  "pattern": "^[0-9]+(\\.[0-9]+)?[mun]s$",
                  "default": "10ms",
                  "description": "Maximum latency for tier migrations"
                },
                "compressionRatio": {
                  "type": "number",
                  "minimum": 2.0,
                  "maximum": 50.0,
                  "default": 10.0,
                  "description": "Target compression ratio for cold storage"
                },
                "retrievalAccuracy": {
                  "type": "number",
                  "minimum": 0.9,
                  "maximum": 1.0,
                  "default": 0.98,
                  "description": "Target retrieval accuracy"
                }
              }
            },
            "monitoring": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true
                },
                "metrics": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": ["tier_distribution", "access_patterns", "migration_frequency", "compression_effectiveness", "fidelity_scores"]
                  },
                  "default": ["tier_distribution", "access_patterns", "compression_effectiveness"]
                },
                "reporting": {
                  "type": "object",
                  "properties": {
                    "interval": {
                      "type": "string",
                      "pattern": "^[0-9]+[smhd]$",
                      "default": "15m",
                      "description": "Performance reporting interval"
                    },
                    "format": {
                      "type": "string",
                      "enum": ["json", "prometheus", "grafana", "custom"],
                      "default": "prometheus"
                    }
                  }
                }
              }
            }
          }
        },
        "integration": {
          "type": "object",
          "properties": {
            "qdrant": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable Qdrant integration (aligned with Drupal)"
                },
                "collection": {
                  "type": "string",
                  "default": "agent_memory",
                  "description": "Qdrant collection name for agent memory"
                },
                "optimizedFor": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": ["speed", "storage", "accuracy", "cost"]
                  },
                  "default": ["speed", "accuracy"]
                }
              }
            },
            "drupal": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable Drupal AI Agents integration"
                },
                "cacheIntegration": {
                  "type": "boolean",
                  "default": true,
                  "description": "Integrate with Drupal cache system"
                },
                "entityStorage": {
                  "type": "boolean",
                  "default": true,
                  "description": "Use Drupal entity storage for persistent contexts"
                }
              }
            }
          }
        },
        "productionSLA": {
          "type": "object",
          "properties": {
            "availability": {
              "type": "number",
              "minimum": 0.99,
              "maximum": 1.0,
              "default": 0.995,
              "description": "Target 99.5% availability SLA"
            },
            "responseTime": {
              "type": "string",
              "pattern": "^[0-9]+(\\.[0-9]+)?[mun]s$",
              "default": "200ms",
              "description": "Maximum response time SLA"
            },
            "dataIntegrity": {
              "type": "number",
              "minimum": 0.999,
              "maximum": 1.0,
              "default": 0.9999,
              "description": "Data integrity guarantee (99.99%)"
            },
            "disasterRecovery": {
              "type": "object",
              "properties": {
                "rto": {
                  "type": "string",
                  "pattern": "^[0-9]+(\\.[0-9]+)?[smh]$",
                  "default": "15m",
                  "description": "Recovery Time Objective"
                },
                "rpo": {
                  "type": "string",
                  "pattern": "^[0-9]+(\\.[0-9]+)?[smh]$",
                  "default": "1m",
                  "description": "Recovery Point Objective"
                }
              }
            }
          }
        }
      }
    }
  }
}