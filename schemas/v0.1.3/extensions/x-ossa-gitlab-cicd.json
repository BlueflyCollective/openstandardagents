{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://open-standards-scalable-agents.org/schemas/v0.1.6/extensions/x-ossa-gitlab-cicd.json",
  "title": "OSSA GitLab CI/CD Integration Extension",
  "description": "Rapid deployment pipelines targeting 4.5-minute deployment cycles for OSSA agents",
  "type": "object",
  "properties": {
    "x-ossa-gitlab-cicd": {
      "type": "object",
      "required": ["deployment", "pipeline", "testing"],
      "properties": {
        "deployment": {
          "type": "object",
          "required": ["enabled", "target", "strategy"],
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable GitLab CI/CD integration"
            },
            "target": {
              "type": "object",
              "required": ["duration", "environments"],
              "properties": {
                "duration": {
                  "type": "string",
                  "pattern": "^[0-9]+(\\.[0-9]+)?m$",
                  "default": "4.5m",
                  "description": "Target deployment duration (4.5 minutes maximum)"
                },
                "environments": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["name", "type", "timeout"],
                    "properties": {
                      "name": {
                        "type": "string",
                        "description": "Environment name"
                      },
                      "type": {
                        "type": "string",
                        "enum": ["development", "staging", "production", "canary"],
                        "description": "Environment type"
                      },
                      "timeout": {
                        "type": "string",
                        "pattern": "^[0-9]+(\\.[0-9]+)?[sm]$",
                        "description": "Environment-specific timeout"
                      },
                      "parallelizable": {
                        "type": "boolean",
                        "default": true,
                        "description": "Can this environment be deployed in parallel"
                      }
                    }
                  }
                },
                "rollbackTime": {
                  "type": "string",
                  "pattern": "^[0-9]+(\\.[0-9]+)?[sm]$",
                  "default": "30s",
                  "description": "Maximum rollback time"
                }
              }
            },
            "strategy": {
              "type": "string",
              "enum": ["blue_green", "canary", "rolling", "immediate"],
              "default": "canary",
              "description": "Deployment strategy"
            },
            "optimization": {
              "type": "object",
              "properties": {
                "parallelStages": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable parallel pipeline stages"
                },
                "caching": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true
                    },
                    "layers": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "enum": ["dependencies", "build_artifacts", "test_results", "container_images"]
                      },
                      "default": ["dependencies", "build_artifacts", "container_images"]
                    },
                    "ttl": {
                      "type": "string",
                      "pattern": "^[0-9]+[hdwm]$",
                      "default": "7d",
                      "description": "Cache time-to-live"
                    }
                  }
                },
                "resourceAllocation": {
                  "type": "object",
                  "properties": {
                    "runners": {
                      "type": "object",
                      "properties": {
                        "count": {
                          "type": "integer",
                          "minimum": 1,
                          "maximum": 20,
                          "default": 4
                        },
                        "type": {
                          "type": "string",
                          "enum": ["shared", "dedicated", "auto_scaling"],
                          "default": "auto_scaling"
                        },
                        "tags": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      }
                    },
                    "concurrency": {
                      "type": "integer",
                      "minimum": 1,
                      "maximum": 10,
                      "default": 3,
                      "description": "Maximum concurrent pipeline jobs"
                    }
                  }
                }
              }
            }
          }
        },
        "pipeline": {
          "type": "object",
          "required": ["stages", "jobs"],
          "properties": {
            "stages": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "duration", "parallel"],
                "properties": {
                  "name": {
                    "type": "string",
                    "enum": ["validate", "build", "test", "security", "deploy", "verify"],
                    "description": "Pipeline stage name"
                  },
                  "duration": {
                    "type": "string",
                    "pattern": "^[0-9]+(\\.[0-9]+)?[sm]$",
                    "description": "Maximum stage duration"
                  },
                  "parallel": {
                    "type": "boolean",
                    "default": true,
                    "description": "Can this stage run in parallel with others"
                  },
                  "retryPolicy": {
                    "type": "object",
                    "properties": {
                      "maxRetries": {
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 3,
                        "default": 1
                      },
                      "when": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "enum": ["always", "on_failure", "on_success", "manual"]
                        },
                        "default": ["on_failure"]
                      }
                    }
                  }
                }
              },
              "default": [
                {"name": "validate", "duration": "30s", "parallel": true},
                {"name": "build", "duration": "90s", "parallel": true},
                {"name": "test", "duration": "120s", "parallel": true},
                {"name": "security", "duration": "45s", "parallel": true},
                {"name": "deploy", "duration": "90s", "parallel": false},
                {"name": "verify", "duration": "15s", "parallel": false}
              ]
            },
            "jobs": {
              "type": "object",
              "properties": {
                "validate": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["name", "script"],
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "script": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "timeout": {
                        "type": "string",
                        "pattern": "^[0-9]+(\\.[0-9]+)?[sm]$",
                        "default": "30s"
                      }
                    }
                  }
                },
                "build": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["name", "script"],
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "script": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "artifacts": {
                        "type": "object",
                        "properties": {
                          "paths": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "expire_in": {
                            "type": "string",
                            "pattern": "^[0-9]+[hdwm]$",
                            "default": "1h"
                          }
                        }
                      }
                    }
                  }
                },
                "test": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["name", "script"],
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "script": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "coverage": {
                        "type": "string",
                        "pattern": "^/.*/$",
                        "description": "Coverage regex pattern"
                      },
                      "reports": {
                        "type": "object",
                        "properties": {
                          "junit": {
                            "type": "string"
                          },
                          "coverage_report": {
                            "type": "object",
                            "properties": {
                              "coverage_format": {
                                "type": "string",
                                "enum": ["cobertura", "jacoco"]
                              },
                              "path": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "testing": {
          "type": "object",
          "required": ["frameworks", "performance"],
          "properties": {
            "frameworks": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "timeout"],
                "properties": {
                  "name": {
                    "type": "string",
                    "enum": ["jest", "playwright", "cypress", "junit", "pytest", "mocha"]
                  },
                  "timeout": {
                    "type": "string",
                    "pattern": "^[0-9]+(\\.[0-9]+)?[sm]$"
                  },
                  "parallel": {
                    "type": "boolean",
                    "default": true
                  },
                  "coverage": {
                    "type": "object",
                    "properties": {
                      "enabled": {
                        "type": "boolean",
                        "default": true
                      },
                      "threshold": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 100,
                        "default": 80
                      }
                    }
                  }
                }
              }
            },
            "performance": {
              "type": "object",
              "properties": {
                "benchmarking": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true
                    },
                    "baseline": {
                      "type": "object",
                      "properties": {
                        "responseTime": {
                          "type": "string",
                          "pattern": "^[0-9]+(\\.[0-9]+)?[sm]$",
                          "default": "200ms"
                        },
                        "throughput": {
                          "type": "integer",
                          "minimum": 1,
                          "default": 100,
                          "description": "Requests per second"
                        },
                        "errorRate": {
                          "type": "number",
                          "minimum": 0,
                          "maximum": 0.05,
                          "default": 0.01,
                          "description": "Maximum error rate (1%)"
                        }
                      }
                    }
                  }
                },
                "loadTesting": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true
                    },
                    "duration": {
                      "type": "string",
                      "pattern": "^[0-9]+(\\.[0-9]+)?[sm]$",
                      "default": "60s"
                    },
                    "users": {
                      "type": "integer",
                      "minimum": 1,
                      "maximum": 1000,
                      "default": 50
                    }
                  }
                }
              }
            }
          }
        },
        "monitoring": {
          "type": "object",
          "properties": {
            "metrics": {
              "type": "object",
              "properties": {
                "deployment": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": ["duration", "success_rate", "rollback_rate", "mttr", "lead_time"]
                  },
                  "default": ["duration", "success_rate", "rollback_rate"]
                },
                "pipeline": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": ["stage_duration", "job_success_rate", "cache_hit_rate", "resource_utilization"]
                  },
                  "default": ["stage_duration", "job_success_rate", "cache_hit_rate"]
                }
              }
            },
            "alerting": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true
                },
                "thresholds": {
                  "type": "object",
                  "properties": {
                    "deployment_duration": {
                      "type": "string",
                      "pattern": "^[0-9]+(\\.[0-9]+)?m$",
                      "default": "5.0m",
                      "description": "Alert if deployment exceeds 5 minutes"
                    },
                    "failure_rate": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1,
                      "default": 0.05,
                      "description": "Alert if failure rate exceeds 5%"
                    }
                  }
                },
                "channels": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": ["email", "slack", "webhook", "gitlab_issue"]
                  },
                  "default": ["slack", "email"]
                }
              }
            }
          }
        }
      }
    }
  }
}