# OAAS Orchestration API Extension v1.0
# OpenAPI 3.1 extension for multi-agent orchestration endpoints
# Framework-agnostic orchestration API with UADP discovery and governance

openapi: 3.1.0
info:
  title: OAAS Multi-Agent Orchestration API
  description: |
    **OpenAPI AI Agents Standard (OAAS) - Multi-Agent Orchestration Extension**
    
    This API specification extends the core OAAS agent APIs with standardized 
    multi-agent orchestration capabilities. It provides framework-agnostic 
    endpoints for coordinating LangChain, CrewAI, AutoGen, OpenAI, Anthropic, 
    and custom agents in research workflows.
    
    ## Key Features
    - **Universal Agent Discovery (UADP)**: Automatic discovery of agents across frameworks
    - **Orchestration Patterns**: Support for parallel, sequential, hierarchical coordination
    - **Research Workflows**: Standardized research agent output formats
    - **Governance Integration**: Policy enforcement and compliance checking
    - **Framework Bridges**: Native integration with popular AI frameworks
    
    ## Orchestration Patterns Supported
    - **Parallel**: Execute multiple agents simultaneously
    - **Sequential**: Chain agents in a specific order
    - **Hierarchical**: Multi-level coordination with escalation
    - **Pipeline**: Stream processing through multiple agents
    - **Fanout**: Distribute tasks to multiple specialized agents
    - **MapReduce**: Parallel processing with result aggregation
    - **Circuit Breaker**: Fault tolerance with fallback agents
    
    ## Framework Compatibility
    This API is designed to work seamlessly with:
    - LangChain (chains, tools, agents)
    - CrewAI (crews, roles, tasks)
    - AutoGen (group chat, sequential chat)
    - OpenAI Assistants (function calling, file search)
    - Anthropic Claude (tool use, message threading)
    - MCP Servers (Model Context Protocol)
    - Custom implementations following OAAS standards
  version: "1.0.0"
  contact:
    name: OAAS Development Team
    email: developers@openapi-ai-agents.org
    url: https://openapi-ai-agents.org
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

# OAAS Extension - Multi-Agent Orchestration
x-openapi-ai-agents-standard:
  version: "1.0.0"
  orchestration:
    supported_patterns: ["parallel", "sequential", "hierarchical", "pipeline", "fanout", "mapreduce", "circuit_breaker"]
    max_agents_per_orchestration: 100
    frameworks_supported: ["langchain", "crewai", "autogen", "openai", "anthropic", "mcp", "custom"]
    governance_integration: true
    uadp_discovery: true
  compliance_frameworks:
    - "ISO_42001_2023"
    - "NIST_AI_RMF_1_0"
    - "EU_AI_Act"
    - "SOX"
    - "HIPAA"
    - "GDPR"

servers:
  - url: https://api.openapi-ai-agents.org/v1
    description: Production OAAS Orchestration Server
  - url: https://staging.openapi-ai-agents.org/v1
    description: Staging OAAS Orchestration Server
  - url: http://localhost:8080/v1
    description: Development OAAS Orchestration Server

paths:
  # Multi-Agent Orchestration Endpoints
  /orchestrate:
    post:
      summary: Start Multi-Agent Orchestration
      description: |
        Initiate a multi-agent orchestration workflow with specified coordination pattern.
        
        This endpoint accepts an orchestration specification and coordinates multiple
        agents according to the defined pattern. It supports all major AI frameworks
        and provides real-time progress tracking with governance integration.
        
        ## Supported Orchestration Patterns
        - **parallel**: Execute agents simultaneously with optional result merging
        - **sequential**: Execute agents in specified order with data passing
        - **hierarchical**: Multi-level coordination with supervisor/worker pattern
        - **pipeline**: Stream data through multiple processing stages
        - **fanout**: Distribute single task to multiple specialized agents
        - **mapreduce**: Parallel processing with aggregation phase
        - **circuit_breaker**: Fault-tolerant execution with fallback strategies
      operationId: startOrchestration
      tags:
        - Orchestration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrchestrationRequest'
            examples:
              parallel_research:
                summary: Parallel Research Orchestration
                description: Execute research agents in parallel for comprehensive analysis
                value:
                  orchestration_spec:
                    apiVersion: "openapi-ai-agents/v1.0"
                    kind: "AgentOrchestration"
                    metadata:
                      name: "parallel-research-analysis"
                      version: "1.0.0"
                    spec:
                      orchestration:
                        name: "Multi-Source Research Analysis"
                        strategy: "parallel"
                        timeout: 300
                      agents:
                        - id: "web-research-agent"
                          type: "research"
                          role: "executor"
                          framework: "langchain"
                          capabilities: ["web_search", "content_analysis"]
                        - id: "academic-research-agent"
                          type: "research"
                          role: "executor"
                          framework: "crewai"
                          capabilities: ["academic_search", "citation_analysis"]
                      coordination:
                        pattern:
                          type: "parallel"
                          configuration:
                            parallel:
                              max_concurrent: 2
                              wait_for_all: true
                  task:
                    description: "Research the impact of quantum computing on cybersecurity"
                    parameters:
                      topic: "quantum computing cybersecurity impact"
                      depth: "comprehensive"
                      sources: ["academic", "industry", "news"]
              sequential_pipeline:
                summary: Sequential Processing Pipeline
                description: Process document through sequential analysis stages
                value:
                  orchestration_spec:
                    apiVersion: "openapi-ai-agents/v1.0"
                    kind: "AgentOrchestration"
                    metadata:
                      name: "document-processing-pipeline"
                      version: "1.0.0"
                    spec:
                      orchestration:
                        name: "Document Processing Pipeline"
                        strategy: "sequential"
                      agents:
                        - id: "document-analyzer"
                          type: "analyzer"
                          role: "executor"
                          framework: "openai"
                        - id: "entity-extractor"
                          type: "extractor"
                          role: "executor"
                          framework: "anthropic"
                        - id: "report-generator"
                          type: "generator"
                          role: "synthesizer"
                          framework: "langchain"
                      coordination:
                        pattern:
                          type: "sequential"
                          configuration:
                            sequential:
                              stop_on_failure: true
                  task:
                    description: "Analyze uploaded document for insights and generate report"
                    parameters:
                      document_url: "https://example.com/document.pdf"
                      output_format: "structured_report"
      responses:
        '200':
          description: Orchestration started successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrchestrationResponse'
        '400':
          description: Invalid orchestration specification
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /orchestrations/{orchestrationId}:
    get:
      summary: Get Orchestration Status
      description: |
        Retrieve the current status and progress of a running or completed orchestration.
        
        This endpoint provides real-time status updates including:
        - Current execution state
        - Individual agent progress
        - Partial results (if available)
        - Performance metrics
        - Error information (if any)
      operationId: getOrchestrationStatus
      tags:
        - Orchestration
      parameters:
        - name: orchestrationId
          in: path
          required: true
          description: Unique identifier for the orchestration
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Orchestration status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrchestrationStatus'
        '404':
          description: Orchestration not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      summary: Cancel Orchestration
      description: Cancel a running orchestration and clean up resources
      operationId: cancelOrchestration
      tags:
        - Orchestration
      parameters:
        - name: orchestrationId
          in: path
          required: true
          description: Unique identifier for the orchestration
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Orchestration cancelled successfully
        '404':
          description: Orchestration not found
        '409':
          description: Orchestration cannot be cancelled (already completed)

  /agents/discover:
    get:
      summary: Universal Agent Discovery (UADP)
      description: |
        Discover available agents across all supported frameworks using the
        Universal Agent Discovery Protocol (UADP).
        
        This endpoint automatically detects and catalogs agents from:
        - LangChain implementations
        - CrewAI crews and agents
        - AutoGen group chat participants
        - OpenAI Assistants
        - Anthropic Claude integrations
        - MCP (Model Context Protocol) servers
        - Custom OAAS-compliant agents
      operationId: discoverAgents
      tags:
        - Discovery
      parameters:
        - name: framework
          in: query
          description: Filter by specific framework
          schema:
            type: string
            enum: ["langchain", "crewai", "autogen", "openai", "anthropic", "mcp", "custom"]
        - name: capability
          in: query
          description: Filter by agent capability
          schema:
            type: string
            examples: ["research", "analysis", "generation", "validation"]
        - name: include_metadata
          in: query
          description: Include detailed agent metadata
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Available agents discovered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  agents:
                    type: array
                    items:
                      $ref: '#/components/schemas/DiscoveredAgent'
                  discovery_timestamp:
                    type: string
                    format: date-time
                  total_agents:
                    type: integer
                  frameworks_detected:
                    type: array
                    items:
                      type: string

  /flows/{flowId}:
    get:
      summary: Get Orchestration Flow Status
      description: |
        Get detailed status of a specific orchestration flow including:
        - Flow execution graph
        - Agent dependencies
        - Data flow between agents
        - Performance bottlenecks
      operationId: getOrchestrationFlow
      tags:
        - Orchestration
        - Monitoring
      parameters:
        - name: flowId
          in: path
          required: true
          description: Unique identifier for the orchestration flow
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Flow status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrchestrationFlow'

  /governance/audit/{auditId}:
    get:
      summary: Get Orchestration Audit Trail
      description: |
        Retrieve comprehensive audit trail for an orchestration including:
        - Policy enforcement actions
        - Compliance check results  
        - Security validations
        - Performance metrics
        - Resource utilization
      operationId: getOrchestrationAudit
      tags:
        - Governance
        - Audit
      parameters:
        - name: auditId
          in: path
          required: true
          description: Unique identifier for the audit trail
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Audit trail retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditTrail'
        '403':
          description: Insufficient permissions to access audit trail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    OrchestrationRequest:
      type: object
      required:
        - orchestration_spec
        - task
      properties:
        orchestration_spec:
          $ref: '#/components/schemas/OrchestrationSpec'
        task:
          type: object
          required:
            - description
          properties:
            description:
              type: string
              description: Task description for the orchestration
            parameters:
              type: object
              description: Task-specific parameters
              additionalProperties: true
            priority:
              type: string
              enum: ["low", "normal", "high", "critical"]
              default: "normal"
            deadline:
              type: string
              format: date-time
              description: Optional task deadline

    OrchestrationSpec:
      type: object
      required:
        - apiVersion
        - kind
        - metadata
        - spec
      properties:
        apiVersion:
          type: string
          const: "openapi-ai-agents/v1.0"
        kind:
          type: string
          const: "AgentOrchestration"
        metadata:
          $ref: '#/components/schemas/OrchestrationMetadata'
        spec:
          $ref: '#/components/schemas/OrchestrationSpecDetails'

    OrchestrationMetadata:
      type: object
      required:
        - name
        - version
      properties:
        name:
          type: string
          pattern: '^[a-z0-9-]+$'
          minLength: 3
          maxLength: 50
        version:
          type: string
          pattern: '^[0-9]+\.[0-9]+\.[0-9]+$'
        description:
          type: string
          maxLength: 1000
        labels:
          type: object
          additionalProperties:
            type: string
        annotations:
          type: object
          additionalProperties:
            type: string

    OrchestrationSpecDetails:
      type: object
      required:
        - orchestration
        - agents
        - coordination
      properties:
        orchestration:
          type: object
          required:
            - name
            - strategy
          properties:
            name:
              type: string
            strategy:
              type: string
              enum: ["parallel", "sequential", "hierarchical", "pipeline", "fanout", "mapreduce", "circuit_breaker"]
            timeout:
              type: integer
              minimum: 1
              maximum: 86400
        agents:
          type: array
          minItems: 2
          maxItems: 100
          items:
            $ref: '#/components/schemas/AgentReference'
        coordination:
          type: object
          required:
            - pattern
          properties:
            pattern:
              $ref: '#/components/schemas/CoordinationPattern'

    AgentReference:
      type: object
      required:
        - id
        - type
        - role
      properties:
        id:
          type: string
          pattern: '^[a-zA-Z0-9_-]+$'
        type:
          type: string
        role:
          type: string
          enum: ["coordinator", "executor", "validator", "synthesizer", "specialist"]
        framework:
          type: string
          enum: ["langchain", "crewai", "autogen", "openai", "anthropic", "mcp", "custom"]
        capabilities:
          type: array
          items:
            type: string
        priority:
          type: integer
          minimum: 1
          maximum: 10
          default: 5

    CoordinationPattern:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          enum: ["parallel", "sequential", "hierarchical", "pipeline", "fanout", "mapreduce", "circuit_breaker"]
        configuration:
          type: object
          additionalProperties: true

    OrchestrationResponse:
      type: object
      required:
        - orchestration_id
        - status
        - created_at
      properties:
        orchestration_id:
          type: string
          format: uuid
        status:
          type: string
          enum: ["started", "error"]
        created_at:
          type: string
          format: date-time
        estimated_completion:
          type: string
          format: date-time
        agents_count:
          type: integer
        pattern:
          type: string

    OrchestrationStatus:
      type: object
      required:
        - orchestration_id
        - status
        - created_at
        - agents
      properties:
        orchestration_id:
          type: string
          format: uuid
        status:
          type: string
          enum: ["planned", "dispatched", "running", "completed", "failed", "cancelled", "timeout"]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        agents:
          type: array
          items:
            $ref: '#/components/schemas/AgentStatus'
        results:
          type: object
          additionalProperties: true
        metrics:
          $ref: '#/components/schemas/OrchestrationMetrics'
        errors:
          type: array
          items:
            $ref: '#/components/schemas/OrchestrationError'

    AgentStatus:
      type: object
      required:
        - id
        - status
      properties:
        id:
          type: string
        status:
          type: string
          enum: ["pending", "running", "completed", "failed", "cancelled"]
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        progress:
          type: number
          minimum: 0
          maximum: 1
        result:
          type: object
          additionalProperties: true
        error:
          type: string

    DiscoveredAgent:
      type: object
      required:
        - id
        - name
        - framework
        - capabilities
        - status
      properties:
        id:
          type: string
        name:
          type: string
        framework:
          type: string
          enum: ["langchain", "crewai", "autogen", "openai", "anthropic", "mcp", "custom"]
        capabilities:
          type: array
          items:
            type: string
        status:
          type: string
          enum: ["available", "busy", "error", "offline"]
        metadata:
          type: object
          additionalProperties: true
        endpoint:
          type: string
          format: uri
        version:
          type: string

    OrchestrationFlow:
      type: object
      properties:
        flow_id:
          type: string
          format: uuid
        orchestration_id:
          type: string
          format: uuid
        execution_graph:
          type: object
          additionalProperties: true
        dependencies:
          type: array
          items:
            type: object
        data_flow:
          type: array
          items:
            type: object
        bottlenecks:
          type: array
          items:
            type: object

    AuditTrail:
      type: object
      properties:
        audit_id:
          type: string
          format: uuid
        orchestration_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        policy_enforcements:
          type: array
          items:
            type: object
        compliance_checks:
          type: array
          items:
            type: object
        security_validations:
          type: array
          items:
            type: object
        performance_metrics:
          $ref: '#/components/schemas/OrchestrationMetrics'

    OrchestrationMetrics:
      type: object
      properties:
        total_duration_ms:
          type: integer
        agent_durations:
          type: object
          additionalProperties:
            type: integer
        throughput:
          type: number
        success_rate:
          type: number
          minimum: 0
          maximum: 1
        resource_utilization:
          type: object
          additionalProperties:
            type: number

    OrchestrationError:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
        message:
          type: string
        agent_id:
          type: string
        timestamp:
          type: string
          format: date-time
        details:
          type: object
          additionalProperties: true

    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
        message:
          type: string
        code:
          type: string
        details:
          type: object
          additionalProperties: true

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - ApiKeyAuth: []
  - BearerAuth: []

tags:
  - name: Orchestration
    description: Multi-agent orchestration operations
  - name: Discovery
    description: Agent discovery and capabilities
  - name: Monitoring
    description: Performance and status monitoring
  - name: Governance
    description: Policy enforcement and audit trails