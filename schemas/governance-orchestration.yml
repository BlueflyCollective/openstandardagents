# OAAS Governance Orchestration Schema v1.0
# Governance hooks, audit trails, and compliance checking for multi-agent orchestration
# Framework-agnostic governance controls with policy enforcement and risk management

$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://openapi-ai-agents.org/schemas/governance-orchestration/v1.0"
title: "OAAS Governance Orchestration Schema"
description: "Standardized governance hooks and compliance checking for orchestration workflows"

type: object
required:
  - apiVersion
  - kind
  - metadata
  - spec

properties:
  apiVersion:
    type: string
    const: "openapi-ai-agents/v1.0"
    description: "OAAS governance specification version"
    
  kind:
    type: string
    const: "GovernanceOrchestration"
    description: "Resource type for governance orchestration specifications"
    
  metadata:
    type: object
    required:
      - name
      - version
    properties:
      name:
        type: string
        pattern: '^[a-z0-9-]+$'
        minLength: 3
        maxLength: 50
        description: "Governance policy identifier"
      version:
        type: string
        pattern: '^[0-9]+\.[0-9]+\.[0-9]+$'
        description: "Governance policy version (semantic versioning)"
      description:
        type: string
        maxLength: 1000
        description: "Governance policy description"
      labels:
        type: object
        additionalProperties:
          type: string
        description: "Key-value labels for policy organization"
      annotations:
        type: object
        additionalProperties:
          type: string
        description: "Additional metadata including compliance frameworks"
      created:
        type: string
        format: date-time
        description: "Policy creation timestamp"
      effective_date:
        type: string
        format: date-time
        description: "Policy effective date"
      expiration_date:
        type: string
        format: date-time
        description: "Optional policy expiration date"
    additionalProperties: false
    
  spec:
    type: object
    required:
      - governance
      - compliance_frameworks
      - policy_hooks
      - audit_requirements
    properties:
      governance:
        type: object
        required:
          - policy_level
          - enforcement_mode
        properties:
          policy_level:
            type: string
            enum: ["advisory", "warning", "enforcing", "blocking"]
            description: "Policy enforcement level"
          enforcement_mode:
            type: string
            enum: ["permissive", "strict", "fail_safe"]
            description: "How to handle policy violations"
          scope:
            type: object
            properties:
              orchestrations:
                type: array
                items:
                  type: string
                description: "Orchestration patterns this governance applies to"
              agents:
                type: array
                items:
                  type: string
                description: "Agent types this governance applies to"
              tasks:
                type: array
                items:
                  type: string
                description: "Task types this governance applies to"
              frameworks:
                type: array
                items:
                  type: string
                  enum: ["langchain", "crewai", "autogen", "openai", "anthropic", "mcp", "all"]
                description: "Frameworks this governance applies to"
            additionalProperties: false
          priority:
            type: integer
            minimum: 1
            maximum: 100
            description: "Policy priority for conflict resolution"
        additionalProperties: false
        
      compliance_frameworks:
        type: array
        minItems: 1
        items:
          type: object
          required:
            - framework
            - controls
          properties:
            framework:
              type: string
              enum: ["ISO_42001_2023", "NIST_AI_RMF_1_0", "EU_AI_Act", "SOX", "HIPAA", "GDPR", "CCPA", "PCI_DSS", "FedRAMP", "SOC2"]
              description: "Compliance framework identifier"
            version:
              type: string
              description: "Framework version"
            controls:
              type: array
              items:
                $ref: "#/$defs/ComplianceControl"
              description: "Specific controls to enforce"
            certification_required:
              type: boolean
              default: false
              description: "Whether certification is required for this framework"
            assessment_frequency:
              type: string
              enum: ["continuous", "monthly", "quarterly", "annually"]
              default: "quarterly"
              description: "Compliance assessment frequency"
        description: "Compliance frameworks to enforce"
        
      policy_hooks:
        type: object
        required:
          - pre_orchestration
          - post_orchestration
        properties:
          pre_orchestration:
            type: array
            items:
              $ref: "#/$defs/PolicyHook"
            description: "Policies executed before orchestration starts"
          pre_agent_execution:
            type: array
            items:
              $ref: "#/$defs/PolicyHook"
            description: "Policies executed before each agent runs"
          post_agent_execution:
            type: array
            items:
              $ref: "#/$defs/PolicyHook"
            description: "Policies executed after each agent completes"
          post_orchestration:
            type: array
            items:
              $ref: "#/$defs/PolicyHook"
            description: "Policies executed after orchestration completes"
          error_handling:
            type: array
            items:
              $ref: "#/$defs/PolicyHook"
            description: "Policies executed on orchestration errors"
        additionalProperties: false
        
      audit_requirements:
        type: object
        required:
          - enabled
          - retention_period
        properties:
          enabled:
            type: boolean
            default: true
            description: "Enable comprehensive audit logging"
          retention_period:
            type: integer
            minimum: 30
            maximum: 2555
            default: 365
            description: "Audit log retention period in days"
          log_levels:
            type: array
            items:
              type: string
              enum: ["debug", "info", "warning", "error", "critical"]
            default: ["info", "warning", "error", "critical"]
            description: "Audit log levels to capture"
          audit_events:
            type: array
            items:
              type: string
              enum: ["orchestration_start", "orchestration_complete", "agent_start", "agent_complete", "policy_violation", "compliance_check", "error_event"]
            description: "Specific events to audit"
          storage_encryption:
            type: boolean
            default: true
            description: "Encrypt audit logs at rest"
          access_controls:
            type: object
            properties:
              read_roles:
                type: array
                items:
                  type: string
                description: "Roles allowed to read audit logs"
              admin_roles:
                type: array
                items:
                  type: string
                description: "Roles allowed to manage audit configuration"
            additionalProperties: false
        additionalProperties: false
        
      risk_management:
        type: object
        properties:
          risk_assessment:
            $ref: "#/$defs/RiskAssessment"
          mitigation_strategies:
            type: array
            items:
              $ref: "#/$defs/MitigationStrategy"
          escalation_policies:
            type: array
            items:
              $ref: "#/$defs/EscalationPolicy"
        additionalProperties: false
        
    additionalProperties: false

# Schema definitions for governance components
$defs:
  ComplianceControl:
    type: object
    required:
      - control_id
      - control_name
      - enforcement_level
    properties:
      control_id:
        type: string
        description: "Unique control identifier"
      control_name:
        type: string
        description: "Human-readable control name"
      control_description:
        type: string
        description: "Detailed control description"
      enforcement_level:
        type: string
        enum: ["advisory", "warning", "enforcing", "blocking"]
        description: "Control enforcement level"
      automated_checks:
        type: array
        items:
          type: string
        description: "Automated validation checks"
      manual_review_required:
        type: boolean
        default: false
        description: "Whether manual review is required"
      evidence_requirements:
        type: array
        items:
          type: string
        description: "Required evidence for compliance"
    additionalProperties: false
    
  PolicyHook:
    type: object
    required:
      - name
      - type
      - action
    properties:
      name:
        type: string
        description: "Policy hook name"
      type:
        type: string
        enum: ["validation", "audit", "compliance", "security", "performance", "custom"]
        description: "Policy hook type"
      action:
        type: string
        enum: ["allow", "deny", "modify", "warn", "log", "escalate"]
        description: "Action to take when policy triggers"
      condition:
        type: string
        description: "Condition expression for policy execution"
      priority:
        type: integer
        minimum: 1
        maximum: 100
        default: 50
        description: "Policy execution priority"
      configuration:
        type: object
        additionalProperties: true
        description: "Policy-specific configuration"
      timeout:
        type: integer
        minimum: 1
        maximum: 300
        default: 30
        description: "Policy execution timeout in seconds"
    additionalProperties: false
    
  RiskAssessment:
    type: object
    required:
      - risk_level
      - assessment_date
    properties:
      risk_level:
        type: string
        enum: ["low", "medium", "high", "critical"]
        description: "Overall risk level"
      assessment_date:
        type: string
        format: date-time
        description: "Risk assessment date"
      risk_factors:
        type: array
        items:
          type: object
          properties:
            factor:
              type: string
            severity:
              type: string
              enum: ["low", "medium", "high", "critical"]
            probability:
              type: string
              enum: ["low", "medium", "high"]
            impact:
              type: string
              enum: ["low", "medium", "high", "critical"]
        description: "Identified risk factors"
      residual_risk:
        type: string
        enum: ["low", "medium", "high", "critical"]
        description: "Risk level after mitigation"
      review_required:
        type: boolean
        default: false
        description: "Whether additional review is required"
      next_assessment_date:
        type: string
        format: date-time
        description: "Next scheduled risk assessment"
    additionalProperties: false
    
  MitigationStrategy:
    type: object
    required:
      - name
      - type
      - implementation_status
    properties:
      name:
        type: string
        description: "Mitigation strategy name"
      type:
        type: string
        enum: ["preventive", "detective", "corrective", "compensating"]
        description: "Type of mitigation strategy"
      description:
        type: string
        description: "Detailed strategy description"
      implementation_status:
        type: string
        enum: ["planned", "in_progress", "implemented", "verified"]
        description: "Implementation status"
      effectiveness:
        type: string
        enum: ["low", "medium", "high"]
        description: "Strategy effectiveness rating"
      cost:
        type: string
        enum: ["low", "medium", "high"]
        description: "Implementation cost"
      timeline:
        type: integer
        description: "Implementation timeline in days"
    additionalProperties: false
    
  EscalationPolicy:
    type: object
    required:
      - trigger_condition
      - escalation_level
      - notification_channels
    properties:
      trigger_condition:
        type: string
        description: "Condition that triggers escalation"
      escalation_level:
        type: integer
        minimum: 1
        maximum: 5
        description: "Escalation severity level"
      notification_channels:
        type: array
        items:
          type: string
          enum: ["email", "slack", "pagerduty", "webhook", "sms"]
        description: "Notification channels for escalation"
      escalation_timeout:
        type: integer
        minimum: 1
        description: "Time before escalating to next level (minutes)"
      responsible_parties:
        type: array
        items:
          type: string
        description: "Responsible parties for this escalation level"
      automated_response:
        type: object
        properties:
          enabled:
            type: boolean
            default: false
          actions:
            type: array
            items:
              type: string
        description: "Automated response configuration"
    additionalProperties: false

additionalProperties: false